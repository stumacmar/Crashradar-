<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CrashRadar Diagnostic Mode</title>

  <style>
    body { background:#0a0e1a; color:#e8eeff; font-family: monospace; padding:20px; }
    h1 { font-size: 22px; }
    .ok { color:#1ec28b; }
    .err { color:#ff6070; white-space:pre-wrap; }
    .box {
      background:#12182b; padding:12px; border-radius:8px;
      margin-bottom:14px; box-shadow:0 0 12px rgba(0,0,0,0.4);
    }
  </style>

</head>

<body>
  <h1>CrashRadar Diagnostic Mode</h1>

  <div class="box">
    <h3>Module Load Results</h3>
    <div id="module-log">Loading modules…</div>
  </div>

  <div class="box">
    <h3>Function Tests</h3>
    <div id="function-log">Waiting…</div>
  </div>

  <div class="box">
    <h3>FRED Cache Load Test</h3>
    <div id="fred-log">Waiting…</div>
  </div>

  <script type="module">
    const moduleLog = document.getElementById('module-log');
    const functionLog = document.getElementById('function-log');
    const fredLog = document.getElementById('fred-log');

    function logOK(msg){ moduleLog.innerHTML += `<div class="ok">✔ ${msg}</div>`; }
    function logERR(msg){ moduleLog.innerHTML += `<div class="err">✖ ${msg}</div>`; }

    async function runDiagnostics() {
      // LOAD MODULES
      let config, scoring, dataService;

      // CONFIG.JS
      try {
        config = await import('./js/config.js');
        logOK('config.js loaded');
      } catch(e) {
        logERR('config.js FAILED:\n' + e);
        return;
      }

      // SCORING.JS
      try {
        scoring = await import('./js/scoring.js');
        logOK('scoring.js loaded');
      } catch(e) {
        logERR('scoring.js FAILED:\n' + e);
        return;
      }

      // DATA SERVICE
      try {
        dataService = await import('./js/dataService.js');
        logOK('dataService.js loaded');
      } catch(e) {
        logERR('dataService.js FAILED:\n' + e);
      }

      // UI MODULES
      const uiFiles = [
        'uiGauge.js','uiIndicators.js','uiCharts.js','uiAudit.js','exports.js'
      ];

      for (let f of uiFiles) {
        try {
          await import('./js/' + f);
          logOK(f + ' loaded');
        } catch(e) {
          logERR(f + ' FAILED:\n' + e);
        }
      }

      // TEST FUNCTIONS IN SCORING
      try {
        let s1 = scoring.scaleIndicator;
        let s2 = scoring.derivedLaborStress;
        let s3 = scoring.computeComposite;

        functionLog.innerHTML =
          `<div class="ok">scaleIndicator: ${typeof s1}</div>` +
          `<div class="ok">derivedLaborStress: ${typeof s2}</div>` +
          `<div class="ok">computeComposite: ${typeof s3}</div>`;
      } catch(e) {
        functionLog.innerHTML =
          `<div class="err">Function test FAILED:\n${e}</div>`;
      }

      // TEST FRED CACHE
      try {
        const res = await fetch('./data/fred_cache.json');
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const json = await res.json();
        fredLog.innerHTML = `<div class="ok">fred_cache.json OK (series: ${Object.keys(json.series).length})</div>`;
      } catch(e) {
        fredLog.innerHTML = `<div class="err">fred_cache.json FAILED:\n${e}</div>`;
      }
    }

    runDiagnostics();
  </script>

</body>
</html>
