<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CrashRadar v3 — Recession Risk Monitor</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
<style>
:root{
  --bg:#0e1324;--card:#161b3a;--text:#eef0ff;--muted:#9aa2c9;
  --ok:#21d07a;--warn:#ffd166;--risk:#ff5c7a;
}
body{margin:0;background:var(--bg);color:var(--text);font:15px system-ui}
h1{font-size:24px;margin:12px 0 4px}
.sub{color:var(--muted);font-size:13px}
.card{background:var(--card);border-radius:10px;padding:14px;margin:10px auto;max-width:1100px}
.chart{height:260px;margin:10px 0;background:#10163a;border-radius:8px;padding:6px}
.gauge{width:200px;height:200px;border-radius:50%;
  background:conic-gradient(var(--ok) 0deg,#20264a 0deg);
  display:grid;place-items:center;margin:auto;position:relative}
.gauge:after{content:"";position:absolute;inset:14px;border-radius:50%;background:#0f1430}
.gauge-val{position:relative;font-weight:700;font-size:28px}
.badge{display:inline-block;padding:4px 10px;border-radius:8px;margin-left:6px}
.g{background:rgba(33,208,122,.15);color:var(--ok)}
.y{background:rgba(255,209,102,.15);color:var(--warn)}
.r{background:rgba(255,92,122,.15);color:var(--risk)}
ul{margin-top:6px;padding-left:18px}
</style>
</head>
<body>
<div class="card" style="text-align:center">
  <h1>CrashRadar v3 — Recession Risk (GAR)</h1>
  <div class="sub">Economist-calibrated composite from FRED data • updated monthly</div>
</div>

<div class="card" style="text-align:center">
  <div id="gauge" class="gauge"><div id="gVal" class="gauge-val">—</div></div>
  <div style="margin-top:8px">
    <span id="badge" class="badge">—</span><br>
    <span class="sub">Green ≤ 30 • Amber ≤ 60 • Red > 60  (lower = safer)</span>
  </div>
</div>

<div class="card">
  <canvas id="compChart"></canvas>
  <div class="sub" style="margin-top:6px">
    The composite blends <b>Yield Curve (10y–3m)</b>, <b>Baa–10Y Credit Spread</b>,
    <b>Bank Lending Standards</b>, <b>Initial Claims</b> and
    <b>Consumer Sentiment</b>. Weighted 0.25/0.25/0.2/0.15/0.15 respectively.
  </div>
</div>

<div class="card" id="insights"><b>Key Insights</b><ul></ul></div>

<div class="card">
  <b>Indicators</b>
  <div class="chart"><canvas id="cYield"></canvas></div>
  <div class="sub">Yield Curve (10y–3m) — Inverted (< 0) = late-cycle risk.</div>

  <div class="chart"><canvas id="cCredit"></canvas></div>
  <div class="sub">Credit Spread (BAA–10y) — Wider = rising corporate stress.</div>

  <div class="chart"><canvas id="cLend"></canvas></div>
  <div class="sub">Bank Lending Standards (NFCI Alt) — Higher = tightening credit.</div>

  <div class="chart"><canvas id="cClaims"></canvas></div>
  <div class="sub">Initial Claims (4-wk avg) — Rising = labor weakness.</div>

  <div class="chart"><canvas id="cSent"></canvas></div>
  <div class="sub">Consumer Sentiment (Index of Michigan) — Lower = confidence shock.</div>
</div>

<script>
const fmt=x=>Number.isFinite(x)?x.toFixed(2):'—';
const w={yield:0.25,credit:0.25,lend:0.2,claims:0.15,sent:0.15};

async function load(){
 try{
  const r=await fetch('data/fred_cache.json');if(!r.ok)throw new Error(r.status);
  const j=await r.json();
  const S=j.series||{};
  const get=(k)=>S[k]?.observations?.map(o=>+o.value).filter(Number.isFinite)||[];

  //--- Pull last values
  const yld=get("T10Y3M").at(-1);
  const cred=get("CREDIT").at(-1);
  const lend=get("LEND")?.at(-1);
  const claims=get("CLAIMS")?.at(-1);
  const sent=get("SENT")?.at(-1);

  //--- Normalise to 0-100 risk (economist calibration)
  function normYield(v){ if(!Number.isFinite(v))return 50; if(v>=2)return 0; if(v<=-1)return 100; return 100*(2-v)/3; }
  function normCredit(v){ if(!Number.isFinite(v))return 50; return Math.min(100,Math.max(0,(v-1)*50)); }
  function normLend(v){ if(!Number.isFinite(v))return 50; return Math.min(100,Math.max(0,(v-0)*80)); }
  function normClaims(v){ if(!Number.isFinite(v))return 50; return Math.min(100,Math.max(0,(v-200)*0.3)); }
  function normSent(v){ if(!Number.isFinite(v))return 50; return Math.min(100,Math.max(0,(80-v)*2)); }

  const ry=normYield(yld), rc=normCredit(cred), rl=normLend(lend), rj=normClaims(claims), rs=normSent(sent);
  const composite= (w.yield*ry + w.credit*rc + w.lend*rl + w.claims*rj + w.sent*rs);
  drawGauge(composite);
  renderCharts(S);
  insights({ry,rc,rl,rj,rs});
 }catch(e){console.error(e);}
}

function drawGauge(score){
 const g=document.getElementById('gauge'),v=document.getElementById('gVal'),b=document.getElementById('badge');
 const deg=Math.min(score,100)*3.6;
 const col=score<=30?'var(--ok)':score<=60?'var(--warn)':'var(--risk)';
 g.style.background=`conic-gradient(${col} ${deg}deg,#2a2f55 ${deg}deg)`;
 v.textContent=fmt(score);
 b.textContent=score<=30?'GREEN':score<=60?'AMBER':'RED';
 b.className='badge '+(score<=30?'g':score<=60?'y':'r');
}

function renderCharts(S){
 const cfg=(id,label,vals,col)=>new Chart(document.getElementById(id),{
  type:'line',data:{labels:Array(vals.length).fill(''),datasets:[{data:vals,borderColor:col,fill:false}]},
  options:{responsive:true,plugins:{legend:{display:false},title:{display:true,text:label,color:'#cfe3ff'}},
           scales:{x:{display:false},y:{ticks:{color:'#9aa2c9'},grid:{color:'rgba(255,255,255,.07)'}}}}
 });
 cfg('cYield','Yield Curve',S.T10Y3M?.observations?.map(o=>+o.value)||[],'#66b2ff');
 cfg('cCredit','Credit Spread',S.CREDIT?.observations?.map(o=>+o.value)||[],'#ffb366');
 cfg('cLend','Lending Standards',S.LEND?.observations?.map(o=>+o.value)||[],'#b49eff');
 cfg('cClaims','Initial Claims',S.CLAIMS?.observations?.map(o=>+o.value)||[],'#ff8899');
 cfg('cSent','Sentiment',S.SENT?.observations?.map(o=>+o.value)||[],'#7dd39f');
}

function insights(r){
 const u=document.querySelector('#insights ul');u.innerHTML='';
 const add=t=>{const li=document.createElement('li');li.textContent=t;u.appendChild(li)};
 if(r.ry>70)add('Yield curve remains inverted – policy cycle late.');
 if(r.rc>60)add('Credit spreads elevated – funding stress building.');
 if(r.rl>50)add('Lending standards tight – credit impulse slowing.');
 if(r.rj>50)add('Jobless claims rising – labor market softening.');
 if(r.rs>50)add('Consumer sentiment weak – demand risk ahead.');
 if(!u.children.length)add('Macro and market indicators remain stable.');
}
load();
</script>
</body>
</html>
