<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Advanced Economic Crash Radar with predictive analytics and multi-timeframe analysis" />
  <title>Economic Crash Radar Pro</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="wrap">
    <header>
      <h1>⚡ Economic Crash Radar Pro</h1>
      <div class="subtitle">Advanced multi-timeframe market stress analysis with predictive analytics</div>
      <div id="statusBadge"></div>
      <div id="auditBox" class="audit"></div>
    </header>

```
<main id="mainContent">
  <div class="loading">Loading economic data...</div>
</main>
```

  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.1.1/dist/chartjs-plugin-annotation.min.js"></script>

  <script src="app.js"></script>

</body>
</html> :root{
–bg:#0a0e1a; –panel:#12182b; –panel-hover:#151d33; –muted:#8b96b0;
–text:#e8eeff; –accent:#6b9eff; –accent-bright:#8fb4ff;
–green:#1ec28b; –amber:#ffc247; –red:#ff6070; –orange:#ff8c42;
–radius:14px; –shadow:0 4px 24px rgba(0,0,0,.3);
–ring:200px; –ring-m:160px;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(–bg);color:var(–text);
font:15px/1.6 -apple-system,BlinkMacSystemFont,“Segoe UI”,Roboto,Inter,Helvetica,Arial,sans-serif}
.wrap{max-width:1400px;margin:0 auto;padding:20px 16px 80px}

header{margin-bottom:24px}
h1{font-size:clamp(32px,5vw,48px);line-height:1.1;margin:0 0 8px;
background:linear-gradient(135deg,var(–text),var(–accent-bright));
-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.subtitle{color:var(–muted);font-size:15px;margin:8px 0}

.card{background:var(–panel);border-radius:var(–radius);padding:24px;margin:20px 0;
box-shadow:var(–shadow),0 0 0 1px rgba(255,255,255,.04) inset;transition:transform .2s,box-shadow .2s}
.card:hover{transform:translateY(-2px);box-shadow:0 6px 32px rgba(0,0,0,.4)}

.gauge-container{display:flex;align-items:center;gap:32px;flex-wrap:wrap}
.gauge-wrap{position:relative;width:var(–ring);height:var(–ring)}
.multi-ring{position:absolute;inset:0}
.ring{position:absolute;border-radius:50%;transition:opacity .3s}
.ring-outer{inset:0;background:conic-gradient(var(–green)0 108deg,var(–amber)108deg 216deg,var(–red)216deg 360deg);opacity:.3}
.ring-mid{inset:15px;background:conic-gradient(var(–green)0 108deg,var(–amber)108deg 216deg,var(–red)216deg 360deg);opacity:.5}
.ring-inner{inset:30px;background:conic-gradient(var(–green)0 108deg,var(–amber)108deg 216deg,var(–red)216deg 360deg)}
.ring::after{content:””;position:absolute;inset:20px;border-radius:50%;background:var(–panel)}
.needle{position:absolute;inset:0;transition:transform .6s cubic-bezier(.34,1.56,.64,1)}
.needle::before{content:””;position:absolute;top:50%;left:50%;width:4px;height:45%;
background:linear-gradient(180deg,var(–accent-bright),var(–accent));
transform:translateX(-50%) translateY(-100%) rotate(var(–angle,0deg));
transform-origin:bottom center;border-radius:4px;box-shadow:0 0 12px var(–accent)}
.needle::after{content:””;position:absolute;top:50%;left:50%;width:16px;height:16px;background:var(–accent-bright);
border-radius:50%;transform:translate(-50%,-50%);box-shadow:0 0 16px var(–accent),0 0 0 3px var(–panel)}
.score{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;font-weight:800;font-size:48px;line-height:1}
.score-label{font-size:12px;font-weight:600;color:var(–muted);margin-top:4px;letter-spacing:.5px}

.gauge-info h2{font-size:28px;margin:0 0 8px;font-weight:700}
.info-box{background:rgba(107,158,255,.08);border-left:3px solid var(–accent);padding:12px 16px;border-radius:8px;margin:12px 0;font-size:13px;line-height:1.6}
.info-box-title{font-weight:700;color:var(–accent-bright);margin-bottom:4px}

.confidence{display:inline-flex;align-items:center;gap:8px;background:rgba(107,158,255,.15);padding:6px 12px;border-radius:8px;font-size:13px;font-weight:600;margin-top:8px}
.confidence-bar{width:60px;height:6px;background:rgba(255,255,255,.1);border-radius:3px;overflow:hidden}
.confidence-fill{height:100%;background:var(–accent);border-radius:3px;transition:width .3s}

.regime-box{background:rgba(255,255,255,.04);border-radius:12px;padding:18px;margin:16px 0;border:1px solid rgba(255,255,255,.08)}
.regime-header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.regime-indicator{width:14px;height:14px;border-radius:50%}
.regime-title{font-size:18px;font-weight:700}
.regime-desc{font-size:13px;line-height:1.6;color:var(–muted);margin-bottom:12px}
.regime-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-top:12px}
.regime-action{background:rgba(255,255,255,.03);padding:10px 12px;border-radius:8px;font-size:12px;border-left:3px solid var(–accent)}
.regime-action-title{font-weight:600;color:var(–text);margin-bottom:2px}

.risk-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-top:16px}
.risk-card{background:rgba(255,255,255,.03);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,.06)}
.risk-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.risk-card-title{font-weight:600;font-size:13px;text-transform:uppercase;letter-spacing:.5px;color:var(–muted)}
.risk-card-value{font-size:32px;font-weight:800;color:var(–accent-bright);line-height:1}
.risk-card-desc{font-size:12px;color:var(–muted);line-height:1.5;margin-top:8px}
.risk-card-detail{font-size:11px;color:var(–text);margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,.06)}

.pills-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
.pill{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);padding:14px 16px;border-radius:12px;transition:all .2s;cursor:pointer;border-left-width:4px}
.pill:hover{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.12);transform:translateY(-2px)}
.pill.rag-green{border-left-color:var(–green)}
.pill.rag-amber{border-left-color:var(–amber)}
.pill.rag-red{border-left-color:var(–red)}
.pill-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.pill-title{font-weight:600;font-size:13px}
.pill-badge{font-size:11px;padding:3px 8px;border-radius:6px;font-weight:600}
.pill-value{font-size:20px;font-weight:700;margin:4px 0}
.pill-change{font-size:12px;color:var(–muted);display:flex;align-items:center;gap:4px}
.pill-desc{font-size:11px;color:var(–muted);line-height:1.4;margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,.06)}
.pill-action{font-size:11px;font-weight:600;margin-top:6px;padding:6px 8px;border-radius:6px;background:rgba(255,255,255,.02)}
.badge-fresh{background:rgba(30,194,139,.15);color:var(–green)}
.badge-stale{background:rgba(255,194,71,.15);color:var(–amber)}
.badge-old{background:rgba(255,96,112,.15);color:var(–red)}

.chart-container{position:relative;height:320px;margin:16px 0}
.chart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:12px}
.chart-title{font-size:18px;font-weight:600;margin:0}
.chart-controls{display:flex;gap:8px}
.btn-group{display:flex;gap:4px;background:rgba(255,255,255,.03);padding:4px;border-radius:8px}
.btn{background:transparent;border:none;color:var(–muted);padding:6px 14px;border-radius:6px;cursor:pointer;font-size:13px;font-weight:500;transition:all .2s}
.btn:hover{color:var(–text);background:rgba(255,255,255,.06)}
.btn.active{background:var(–accent);color:#fff}

.tabs{display:flex;gap:8px;border-bottom:2px solid rgba(255,255,255,.06);margin-bottom:20px;overflow-x:auto}
.tab{background:transparent;border:none;color:var(–muted);padding:12px 20px;cursor:pointer;font-size:14px;font-weight:600;position:relative;white-space:nowrap}
.tab:hover{color:var(–text)}
.tab.active{color:var(–accent-bright)}
.tab.active::after{content:””;position:absolute;bottom:-2px;left:0;right:0;height:2px;background:var(–accent)}
.tab-content{display:none}
.tab-content.active{display:block}

.status{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:8px;font-weight:600;font-size:13px}
.status-dot{width:8px;height:8px;border-radius:50%}

.heatmap{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}
.heat-cell{background:rgba(255,255,255,.03);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,.06);border-left-width:4px}
.heat-cell.rag-green{border-left-color:var(–green)}
.heat-cell.rag-amber{border-left-color:var(–amber)}
.heat-cell.rag-red{border-left-color:var(–red)}
.heat-label{font-size:12px;color:var(–muted)}
.heat-value{font-size:22px;font-weight:700}
.bar{height:6px;border-radius:4px;background:rgba(255,255,255,.08);overflow:hidden;margin-top:8px}
.bar > span{display:block;height:100%;border-radius:4px}

.audit{font-size:12px;color:var(–muted);margin-top:8px}
.audit .bad{color:#ff9da6}
.audit .warn{color:#ffc247}

.loading{text-align:center;padding:40px;color:var(–muted)}
.error-state{background:rgba(255,96,112,.1);border:1px solid rgba(255,96,112,.3);padding:20px;border-radius:var(–radius);margin:20px 0}

@media (max-width:768px){
.gauge-container{justify-content:center;text-align:center}
.gauge-wrap{width:var(–ring-m);height:var(–ring-m)}
.score{font-size:36px}
.pills-grid{grid-template-columns:1fr}
.chart-header{flex-direction:column;align-items:flex-start}
} // Economic Crash Radar Pro - JavaScript Part 1
// Configuration, Data Services, and Analytics

‘use strict’;

const CONFIG = {
FRED_CACHE_PATH: ‘data/fred_cache.json’,
CACHE_TIMEOUT: 10000,

INDICATORS: {
T10Y3M: {
label: ‘Yield Curve’,
format: v => v?.toFixed(2) + ‘%’,
weight: 0.18,
cadence: ‘daily’,
description: ‘Difference between 10-year and 3-month Treasury yields’,
interpretation: ‘Inverted (negative) curves have preceded every recession since 1955, typically 6-18 months in advance’,
thresholds: { green: [0.5, 99], amber: [-0.5, 0.5], red: [-99, -0.5] },
action: {
green: ‘Normal credit cycle - Continue regular allocation’,
amber: ‘Flattening curve - Monitor for inversion, reduce duration’,
red: ‘INVERTED - Recession signal. Reduce equity exposure, add defensive positions’
}
},
CREDIT: {
label: ‘Credit Spread’,
format: v => v?.toFixed(2) + ‘%’,
weight: 0.14,
cadence: ‘daily’,
description: ‘High-yield bond spread over risk-free Treasuries’,
interpretation: ‘Widening spreads show investors demanding more compensation for default risk. Above 7% historically signals distress’,
thresholds: { green: [-99, 4.5], amber: [4.5, 7.0], red: [7.0, 99] },
action: {
green: ‘Healthy credit markets - Normal high-yield exposure acceptable’,
amber: ‘Rising risk premium - Trim junk bonds, favor quality’,
red: ‘CREDIT CRUNCH - Exit high-yield, move to investment grade or Treasuries’
}
},
UN_SLOPE6: {
label: ‘Unemployment Trend’,
format: v => (v >= 0 ? ‘+’ : ‘’) + v?.toFixed(2) + ‘%’,
weight: 0.12,
cadence: ‘monthly’,
description: ‘6-month change in unemployment rate’,
interpretation: ‘Sahm Rule: 0.5%+ rise from 12-month low triggers recession indicator. Unemployment rarely rises slowly’,
thresholds: { green: [-99, 0.15], amber: [0.15, 0.35], red: [0.35, 99] },
action: {
green: ‘Stable labor market - Consumer spending should hold’,
amber: ‘Softening employment - Watch consumer discretionary stocks’,
red: ‘RECESSION LIKELY - Labor market deteriorating, recession may have started’
}
},
DD_12M: {
label: ‘Market Drawdown’,
format: v => ((v ?? 0) * 100).toFixed(1) + ‘%’,
weight: 0.20,
cadence: ‘daily’,
description: ‘S&P 500 decline from 12-month peak’,
interpretation: ‘-10% = correction, -20% = bear market. Deep drawdowns often coincide with economic deterioration’,
thresholds: { green: [-5, 0], amber: [-15, -5], red: [-99, -15] },
action: {
green: ‘Near all-time highs - Normal volatility expected’,
amber: ‘Correction territory - Consider trimming winners, raising cash’,
red: ‘BEAR MARKET - Defensive positioning, quality over growth’
}
},
NFCI: {
label: ‘Financial Conditions’,
format: v => v?.toFixed(2),
weight: 0.12,
cadence: ‘weekly’,
description: ‘Chicago Fed National Financial Conditions Index’,
interpretation: ‘Zero = average. Positive = tight conditions. Sharp increases (>0.5) often precede recessions’,
thresholds: { green: [-99, -0.20], amber: [-0.20, 0.30], red: [0.30, 99] },
action: {
green: ‘Easy financial conditions - Risk assets supported’,
amber: ‘Tightening conditions - Reduce leverage, watch credit spreads’,
red: ‘FINANCIAL STRESS - Liquidity concerns, defensive positioning’
}
},
VIX_PROXY: {
label: ‘Volatility Index’,
format: v => v?.toFixed(1),
weight: 0.10,
cadence: ‘daily’,
description: ‘CBOE Volatility Index (VIX) - market fear gauge’,
interpretation: ‘<15 = complacent, 20-30 = elevated fear, >35 = panic. Sustained low VIX can signal complacency’,
thresholds: { green: [-99, 20], amber: [20, 30], red: [30, 99] },
action: {
green: ‘Low volatility - Consider tail-risk hedges if extended’,
amber: ‘Rising uncertainty - Reduce position sizes, add hedges’,
red: ‘MARKET PANIC - Wait for stabilization before deploying cash’
}
},
RETAIL_MOMENTUM: {
label: ‘Retail Sales Growth’,
format: v => ((v ?? 0) * 100).toFixed(2) + ‘%’,
weight: 0.08,
cadence: ‘monthly’,
description: ‘Month-over-month retail sales change’,
interpretation: ‘Consumer spending is 70% of GDP. Negative growth for 2+ months signals recession risk’,
thresholds: { green: [0.01, 99], amber: [-0.01, 0.01], red: [-99, -0.01] },
action: {
green: ‘Strong consumer spending - Discretionary stocks supported’,
amber: ‘Stalling consumption - Monitor consumer stocks closely’,
red: ‘CONSUMER RETRENCHMENT - Avoid discretionary, favor staples’
}
},
SENTIMENT: {
label: ‘Consumer Confidence’,
format: v => v?.toFixed(1),
weight: 0.06,
cadence: ‘monthly’,
description: ‘University of Michigan Consumer Sentiment Index’,
interpretation: ‘Leading indicator for spending. <80 = pessimistic. Sharp drops (>10 pts) precede recessions’,
thresholds: { green: [90, 999], amber: [70, 90], red: [-99, 70] },
action: {
green: ‘Optimistic consumers - Spending should remain robust’,
amber: ‘Cautious consumers - Monitor spending data closely’,
red: ‘FEARFUL CONSUMERS - Expect spending cuts, recession risk elevated’
}
}
},

FRESH_LIMITS: {
daily: { ok: 7, warn: 30 },
weekly: { ok: 7, warn: 30 },
monthly: { ok: 30, warn: 60 }
},

ZONE_COLORS: {
green: ‘#1ec28b’,
amber: ‘#ffc247’,
red: ‘#ff6070’
}
};

const Utils = {
clamp: (x, min = 0, max = 100) => Math.max(min, Math.min(max, x)),

map01: (val, good, bad) => {
if (val == null) return 50;
const denom = bad - good;
if (Math.abs(denom) < 1e-9) return 50;
return ((val - good) / denom) * 100;
},

zoneOf: score => score <= 30 ? ‘green’ : (score <= 60 ? ‘amber’ : ‘red’),

heatColor: score => {
const r = Math.round(255 * (score / 100));
const g = Math.round(200 * (1 - score / 100));
return `rgb(${r},${g},80)`;
},

safeParseFloat: val => {
if (val == null || val === ‘.’ || val === ‘NaN’ || val === ‘’) return null;
const num = +val;
return isFinite(num) ? num : null;
},

getRAGStatus: (value, thresholds) => {
if (!thresholds || value == null) return ‘amber’;
if (value >= thresholds.red[0] && value <= thresholds.red[1]) return ‘red’;
if (value >= thresholds.amber[0] && value <= thresholds.amber[1]) return ‘amber’;
return ‘green’;
}
};

const SCALE = {
T10Y3M: v => Utils.clamp(Utils.map01(v, 1.0, -2.0)),
CREDIT: v => Utils.clamp(Utils.map01(v, 3.0, 8.0)),
UN_SLOPE6: v => Utils.clamp(Utils.map01(v, 0.05, 0.50)),
DD_12M: v => Utils.clamp(Utils.map01(v, 0.00, -0.20)),
NFCI: v => Utils.clamp(Utils.map01(v, -0.80, 0.40)),
VIX_PROXY: v => Utils.clamp(Utils.map01(v, 12, 35)),
RETAIL_MOMENTUM: v => Utils.clamp(Utils.map01(v, 0.03, -0.02)),
SENTIMENT: v => Utils.clamp(Utils.map01(v, 110, 70))
};

class DataService {
static async loadFredCache() {
const controller = new AbortController();
const timeout = setTimeout(() => controller.abort(), CONFIG.CACHE_TIMEOUT);

```
try {
  const res = await fetch(`${CONFIG.FRED_CACHE_PATH}?t=${Date.now()}`, { 
    cache: 'no-store',
    signal: controller.signal
  });
  
  clearTimeout(timeout);
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  
  const raw = await res.json();
  return this.normalizeCache(raw);
} catch (err) {
  clearTimeout(timeout);
  if (err.name === 'AbortError') throw new Error('Request timeout');
  throw err;
}
```

}

static normalizeCache(raw) {
const out = {};
if (!raw) return out;

```
const directLike = typeof raw === 'object' && 
  Object.keys(raw).some(k => raw[k] && Array.isArray(raw[k].observations));

if (directLike) return raw;

if (Array.isArray(raw?.series)) {
  for (const item of raw.series) {
    const id = item?.id || item?.series_id || item?.name;
    if (!id) continue;
    const obs = Array.isArray(item.observations) ? item.observations :
               Array.isArray(item.data) ? item.data : [];
    out[id] = { observations: obs, fetchedAt: item.fetchedAt };
  }
  return out;
}

if (raw.series && typeof raw.series === 'object') {
  for (const [id, item] of Object.entries(raw.series)) {
    const obs = Array.isArray(item?.observations) ? item.observations :
               Array.isArray(item?.data) ? item.data : [];
    out[id] = { observations: obs, fetchedAt: item.fetchedAt };
  }
  return out;
}

if (Array.isArray(raw)) {
  for (const item of raw) {
    const id = item?.id || item?.series_id || item?.name;
    if (!id) continue;
    const obs = Array.isArray(item.observations) ? item.observations :
               Array.isArray(item.data) ? item.data : [];
    out[id] = { observations: obs, fetchedAt: item.fetchedAt };
  }
}

return out;
```

}

static latest(series) {
const obs = series?.observations || [];
if (!obs.length) return null;
const o = obs[obs.length - 1];
const v = Utils.safeParseFloat(o.value);
return { value: v, date: o.date };
}

static seriesAgeDays(series, fetchedAt) {
const L = this.latest(series);
if (!L) return Infinity;
const d = new Date(L.date + ‘T00:00:00Z’);
const ref = new Date(fetchedAt || Date.now());
return Math.max(0, Math.round((ref - d) / 86400000));
}
}

class DerivedSeries {
static deriveUnempSlope6(UNRATE) {
const obs = UNRATE?.observations || [];
if (!obs.length) return null;

```
const byMonth = {};
for (const o of obs) {
  const v = Utils.safeParseFloat(o.value);
  if (v !== null) byMonth[o.date.slice(0, 7)] = v;
}

const months = Object.keys(byMonth).sort();
if (months.length < 7) return null;

const out = [];
for (let i = 6; i < months.length; i++) {
  const m = months[i], prev = months[i - 6];
  const delta = byMonth[m] - byMonth[prev];
  const [yy, mm] = m.split('-').map(Number);
  const d = new Date(Date.UTC(yy, mm, 0));
  out.push({ date: d.toISOString().slice(0, 10), value: String(delta) });
}

return { observations: out, fetchedAt: UNRATE.fetchedAt };
```

}

static deriveDrawdown12m(SP500) {
const obs = SP500?.observations || [];
if (!obs.length) return null;

```
const dates = obs.map(o => o.date);
const vals = obs.map(o => Utils.safeParseFloat(o.value));
const peak = [];

for (let i = 0; i < vals.length; i++) {
  const start = Math.max(0, i - 252);
  let p = -Infinity;
  for (let j = start; j <= i; j++) {
    if (vals[j] !== null) p = Math.max(p, vals[j]);
  }
  peak.push(p);
}

const dd = dates.map((d, i) => ({
  date: d,
  value: vals[i] !== null && peak[i] !== -Infinity ? String(vals[i] / peak[i] - 1) : '.'
}));

return { observations: dd, fetchedAt: SP500.fetchedAt };
```

}

static deriveRetailMomentum(RSAFS) {
const o = RSAFS?.observations || [];
if (o.length < 2) return null;

```
const last = Utils.safeParseFloat(o[o.length - 1].value);
let prev = null;

for (let i = o.length - 2; i >= 0; i--) {
  const v = Utils.safeParseFloat(o[i].value);
  if (v !== null) {
    prev = v;
    break;
  }
}

if (prev === null || prev === 0 || last === null) return null;

return {
  observations: [{ date: o[o.length - 1].date, value: String(last / prev - 1) }],
  fetchedAt: RSAFS.fetchedAt
};
```

}
}

// Continue in Part 2… // Economic Crash Radar Pro - JavaScript Part 2
// Indicator Processing, Analytics, and Application Logic
// NOTE: This file requires Part 1 to be loaded first

class IndicatorProcessor {
static mapIndicatorsFromCache(cache) {
const out = {};

```
for (const k of Object.keys(CONFIG.INDICATORS)) {
  if (cache[k]) out[k] = cache[k];
}

if (!out.CREDIT && (cache.BAMLH0A0HYM2 || cache.BAA10YM)) {
  out.CREDIT = cache.BAMLH0A0HYM2 || cache.BAA10YM;
}
if (!out.VIX_PROXY && cache.VIXCLS) out.VIX_PROXY = cache.VIXCLS;
if (!out.SENTIMENT && cache.UMCSENT) out.SENTIMENT = cache.UMCSENT;

if (!out.UN_SLOPE6 && cache.UNRATE) {
  out.UN_SLOPE6 = DerivedSeries.deriveUnempSlope6(cache.UNRATE) || 
    { observations: [], fetchedAt: cache.UNRATE.fetchedAt };
}
if (!out.DD_12M && cache.SP500) {
  out.DD_12M = DerivedSeries.deriveDrawdown12m(cache.SP500) || 
    { observations: [], fetchedAt: cache.SP500.fetchedAt };
}
if (!out.RETAIL_MOMENTUM && cache.RSAFS) {
  out.RETAIL_MOMENTUM = DerivedSeries.deriveRetailMomentum(cache.RSAFS) || 
    { observations: [], fetchedAt: cache.RSAFS.fetchedAt };
}

return out;
```

}

static freshnessPenalty(days, cadence, isCalm = false) {
const lim = CONFIG.FRESH_LIMITS[cadence] || CONFIG.FRESH_LIMITS.daily;
const ok = isCalm ? Math.floor(lim.ok / 2) : lim.ok;
const warn = isCalm ? Math.floor(lim.warn / 2) : lim.warn;

```
if (days <= ok) return 1.00;
if (days <= warn) return 0.85;
return 0.70;
```

}

static computeComposite(dataMap, isCalm) {
let num = 0, den = 0;
const parts = [];

```
for (const [k, cfg] of Object.entries(CONFIG.INDICATORS)) {
  const s = dataMap[k];
  const obs = s?.observations || [];
  if (!obs.length) continue;
  
  const L = DataService.latest(s);
  if (!L || L.value === null) continue;

  const days = DataService.seriesAgeDays(s, s.fetchedAt);
  const lim = CONFIG.FRESH_LIMITS[cfg.cadence] || CONFIG.FRESH_LIMITS.daily;
  const badge = days <= lim.ok ? { cls: 'badge-fresh', txt: 'Fresh' } :
               days <= lim.warn ? { cls: 'badge-stale', txt: 'Stale' } :
               { cls: 'badge-old', txt: 'Old' };

  const scaled = SCALE[k](L.value);
  const w = cfg.weight * this.freshnessPenalty(days, cfg.cadence, isCalm);
  
  if (Number.isFinite(scaled) && Number.isFinite(w)) {
    num += scaled * w;
    den += w;
  }

  const ragStatus = Utils.getRAGStatus(L.value, cfg.thresholds);

  let change = null;
  if (obs.length >= 2) {
    const a = Utils.safeParseFloat(obs[obs.length - 1].value);
    const b = Utils.safeParseFloat(obs[obs.length - 2].value);
    if (a !== null && b !== null) change = a - b;
  }

  parts.push({
    key: k,
    label: cfg.label,
    valueDisp: cfg.format?.(L.value) ?? L.value,
    rawValue: L.value,
    change,
    freshClass: badge.cls,
    freshTxt: badge.txt,
    days,
    scaled,
    w,
    obs,
    ragStatus,
    description: cfg.description,
    interpretation: cfg.interpretation,
    action: cfg.action
  });
}

return { parts, num, den };
```

}
}

class Analytics {
static complacencyPenalty(dataMap) {
const vix = dataMap.VIX_PROXY?.observations || [];
const hy = dataMap.CREDIT?.observations || [];
const dd = dataMap.DD_12M?.observations || [];

```
if (vix.length < 22 || hy.length < 1 || dd.length < 1) return 0;

let streak = 0;
for (let i = vix.length - 1; i >= 0 && streak < 60; i--) {
  const val = Utils.safeParseFloat(vix[i].value);
  if (val !== null && val <= 13) streak++;
  else break;
}
const vixScore = Math.min(1, streak / 30);

const hyLast = Utils.safeParseFloat(hy[hy.length - 1].value);
const spreadTight = hyLast !== null && hyLast <= 3.5 ? 1 : 0;

const ddLast = Utils.safeParseFloat(dd[dd.length - 1].value);
const shallowDD = ddLast !== null && ddLast >= -0.05 ? 1 : 0;

const raw = 0.5 * vixScore + 0.3 * spreadTight + 0.2 * shallowDD;
return Math.round(15 * raw);
```

}

static inflationDriftPenalty(cache) {
const CPI = cache.CPI_YOY || cache.CPIAUCSL_YOY || null;
if (!CPI?.observations?.length) return 0;

```
const o = CPI.observations;
const last = Utils.safeParseFloat(o[o.length - 1].value);
if (last === null) return 0;

if (last <= 2.5) return 0;
if (last <= 3.5) return Math.round(1 + 2 * (last - 2.5));
return Math.min(6, Math.round(2 + 2 * (last - 3.5)));
```

}

static compositeMomentum(hist, lookbackDays) {
if (!hist?.length) return 0;
const n = hist.length;
const a = Math.max(0, n - 1 - lookbackDays);
const b = n - 1;
const da = hist[a]?.value ?? hist[0].value;
const db = hist[b]?.value ?? hist[n - 1].value;
return db - da;
}

static horizonRiskSmart(composite, hist) {
const m20 = this.compositeMomentum(hist, 20);
const m60 = this.compositeMomentum(hist, 60);
const m120 = this.compositeMomentum(hist, 120);

```
const base = x => 1 / (1 + Math.exp(-(x - 50) / 10));
const p1 = base(composite) * (0.70 + 0.02 * m20);
const p3 = base(composite) * (0.95 + 0.015 * m60);
const p6 = base(composite) * (1.20 + 0.010 * m120);

const clip = p => Math.round(Math.max(5, Math.min(95, 100 * p)));
return { p1: clip(p1), p3: clip(p3), p6: clip(p6) };
```

}

static buildCompositeHistory(dataMap) {
const keysForHist = [‘DD_12M’, ‘VIX_PROXY’, ‘T10Y3M’, ‘CREDIT’, ‘NFCI’];
const allDates = new Set();

```
for (const k of keysForHist) {
  (dataMap[k]?.observations || []).forEach(o => allDates.add(o.date));
}

const dates = Array.from(allDates).sort();

return dates.map(date => {
  let n = 0, d = 0;
  
  for (const [k, cfg] of Object.entries(CONFIG.INDICATORS)) {
    const s = dataMap[k];
    if (!s) continue;
    
    const obs = s.observations;
    let v = null;
    
    for (let i = obs.length - 1; i >= 0; i--) {
      if (obs[i].date <= date) {
        const vv = Utils.safeParseFloat(obs[i].value);
        if (vv !== null) {
          v = vv;
          break;
        }
      }
    }
    
    if (v === null) continue;
    const sc = SCALE[k](v);
    n += sc * cfg.weight;
    d += cfg.weight;
  }
  
  return { date, value: d > 0 ? +(n / d).toFixed(1) : null };
}).filter(x => x.value !== null);
```

}
}

class App {
constructor() {
this.state = {
dataMap: null,
compositeHistory: [],
cache: null
};
this.charts = { composite: null, decomp: null, traj: null };
this.currentTimeframe = ‘1m’;
}

async init() {
try {
this.setStatus(‘green’, ‘Loading data…’);

```
  const cache = await DataService.loadFredCache();
  this.state.cache = cache;
  
  const dataMap = IndicatorProcessor.mapIndicatorsFromCache(cache);
  this.state.dataMap = dataMap;
  
  const vixObs = dataMap.VIX_PROXY?.observations || [];
  const creditObs = dataMap.CREDIT?.observations || [];
  const isCalm = vixObs.slice(-1).some(o => Utils.safeParseFloat(o.value) <= 13) &&
                creditObs.slice(-1).some(o => Utils.safeParseFloat(o.value) <= 3.5);
  
  const { parts, num, den } = IndicatorProcessor.computeComposite(dataMap, isCalm);
  
  if (den <= 0) throw new Error('No valid indicators with positive weights');
  
  const compositeBase = num / den;
  const penalty = Analytics.complacencyPenalty(dataMap);
  const infl = Analytics.inflationDriftPenalty(cache);
  const composite = Math.min(100, compositeBase + penalty + infl);
  
  this.state.compositeHistory = Analytics.buildCompositeHistory(dataMap);
  
  this.renderUI(composite, parts, penalty, infl);
  
} catch (err) {
  console.error('Initialization error:', err);
  this.showError(err.message || 'Unknown error');
}
```

}

renderUI(composite, parts, penalty, infl) {
const zone = Utils.zoneOf(composite);
const regimeName = {green: ‘Normal’, amber: ‘Stressed’, red: ‘Crisis’}[zone];
const regimeColor = CONFIG.ZONE_COLORS[zone];

```
const { p1, p3, p6 } = Analytics.horizonRiskSmart(composite, this.state.compositeHistory);

const fresh = parts.filter(p => p.days <= 30).length;
const confidence = Math.round((fresh / parts.length) * 100);

const regimeDesc = {
  green: 'Economic fundamentals are stable. Normal market volatility expected. Risk indicators within historical norms. Continue regular investment approach.',
  amber: 'Elevated stress detected across multiple indicators. Increased probability of market volatility and economic softening. Monitor closely for further deterioration. Consider reducing risk exposure.',
  red: 'Critical stress levels reached. Multiple recession indicators triggered. High probability of significant market downturn and/or economic contraction underway or imminent. Defensive positioning recommended.'
}[zone];

const redIndicators = parts.filter(p => p.ragStatus === 'red');

document.getElementById('mainContent').innerHTML = `
  <!-- Gauge Section -->
  <section class="card">
    <div class="gauge-container">
      <div class="gauge-wrap">
        <div class="multi-ring">
          <div class="ring ring-outer"></div>
          <div class="ring ring-mid"></div>
          <div class="ring ring-inner"></div>
        </div>
        <div class="needle" style="--angle:${(composite / 100) * 360}deg"></div>
        <div class="score"><div>${Math.round(composite)}</div><div class="score-label">COMPOSITE</div></div>
      </div>

      <div class="gauge-info">
        <h2>Market Stress Index: ${Math.round(composite)}/100</h2>
        <div style="color:var(--muted);margin-bottom:12px">
          Weighted composite of ${parts.length} economic indicators
        </div>
        
        <div class="info-box">
          <div class="info-box-title">Data Confidence: ${confidence}%</div>
          This measures data freshness and completeness. ${
            confidence >= 80 ? 'High confidence - all indicators current and reliable.' : 
            confidence >= 60 ? 'Moderate confidence - some indicators have stale data which reduces weight.' : 
            'Low confidence - significant data staleness affecting reliability.'
          }
          ${fresh < parts.length ? ` ${parts.length - fresh} indicator(s) over 30 days old.` : ''}
        </div>
        
        <div class="regime-box">
          <div class="regime-header">
            <div class="regime-indicator" style="background:${regimeColor}"></div>
            <div class="regime-title">${regimeName} Regime</div>
          </div>
          <div class="regime-desc">${regimeDesc}</div>
          ${redIndicators.length > 0 ? `
            <div class="regime-actions">
              ${redIndicators.map(p => `
                <div class="regime-action">
                  <div class="regime-action-title">⚠️ ${p.label}</div>
                  ${p.action[p.ragStatus]}
                </div>
              `).join('')}
            </div>
          ` : '<div style="color:var(--green);margin-top:8px">✓ No critical indicators in stress</div>'}
        </div>
      </div>
    </div>
  </section>

  <!-- Risk Horizon -->
  <section class="card">
    <h3 style="margin:0 0 16px">Forward Risk Horizon</h3>
    <div class="risk-cards">
      <div class="risk-card">
        <div class="risk-card-title">1-Month Risk</div>
        <div class="risk-card-value">${p1}%</div>
        <div class="risk-card-desc">
          Probability of >10% market drawdown within 30 days based on current stress levels and short-term momentum trends.
        </div>
        <div class="risk-card-detail">
          <strong>What it means:</strong> ${p1 < 20 ? 'Low near-term volatility risk. Markets likely stable.' : p1 < 40 ? 'Elevated short-term risk. Expect increased volatility.' : 'High crash probability. Significant downturn possible within weeks.'}
        </div>
      </div>
      <div class="risk-card">
        <div class="risk-card-title">3-Month Risk</div>
        <div class="risk-card-value">${p3}%</div>
        <div class="risk-card-desc">
          Probability of sustained correction (>15% decline) within next quarter, incorporating medium-term trend deterioration and macro headwinds.
        </div>
        <div class="risk-card-detail">
          <strong>What it means:</strong> ${p3 < 25 ? 'Markets should remain relatively stable over next quarter.' : p3 < 50 ? 'Correction is possible. Monitor positioning closely.' : 'High correction risk. Consider defensive allocation.'}
        </div>
      </div>
      <div class="risk-card">
        <div class="risk-card-title">6-Month Risk</div>
        <div class="risk-card-value">${p6}%</div>
        <div class="risk-card-desc">
          Probability of bear market (>20% decline) or recession within 6 months, based on historical patterns of macro deterioration and recession signals.
        </div>
        <div class="risk-card-detail">
          <strong>What it means:</strong> ${p6 < 30 ? 'Low recession risk. Economic expansion likely continues.' : p6 < 60 ? 'Elevated recession risk. Economic slowdown possible.' : 'High recession probability. Downturn likely within 6 months.'}
        </div>
      </div>
    </div>
  </section>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" onclick="app.showTab('indicators')">Live Indicators</button>
    <button class="tab" onclick="app.showTab('charts')">Charts</button>
    <button class="tab" onclick="app.showTab('heatmap')">Heat Map</button>
  </div>

  <!-- Indicators Tab -->
  <div id="tab-indicators" class="tab-content active">
    <section class="card">
      <h3 style="margin:0 0 8px">Individual Indicator Status</h3>
      <p style="color:var(--muted);font-size:13px;margin:0 0 16px">
        Each indicator shows its current RAG status, interpretation, and recommended action. 
        Colored left borders indicate: Green = Normal, Amber = Elevated, Red = Stressed.
      </p>
      <div class="pills-grid">
        ${parts.map(p => `
          <div class="pill rag-${p.ragStatus}">
            <div class="pill-header">
              <div class="pill-title">${p.label}</div>
              <div class="pill-badge ${p.freshClass}">${p.freshTxt}</div>
            </div>
            <div class="pill-value">${p.valueDisp}</div>
            ${p.change != null ? `
              <div class="pill-change">
                <span>${p.change > 0 ? '▲' : '▼'}</span>
                ${(p.change > 0 ? '+' : '') + p.change.toFixed(2)}
              </div>
            ` : ''}
            <div class="pill-desc">
              <strong>${p.description}</strong><br>
              ${p.interpretation}
            </div>
            <div class="pill-action" style="color:var(--${p.ragStatus})">
              ${p.action[p.ragStatus]}
            </div>
            ${p.days > 30 ? `<div style="font-size:10px;color:var(--amber);margin-top:6px">⚠️ Data ${p.days} days old - reduced weight</div>` : ''}
          </div>
        `).join('')}
      </div>
    </section>
  </div>

  <!-- Charts Tab -->
  <div id="tab-charts" class="tab-content">
    <section class="card">
      <h3>Composite History</h3>
      <div class="chart-container"><canvas id="compositeChart"></canvas></div>
    </section>
  </div>

  <!-- Heatmap Tab -->
  <div id="tab-heatmap" class="tab-content">
    <section class="card">
      <h3 style="margin:0 0 16px">Indicator Heat Map</h3>
      <div class="heatmap">
        ${parts.map(p => `
          <div class="heat-cell rag-${p.ragStatus}">
            <div class="heat-label">${p.label}</div>
            <div class="heat-value">${p.valueDisp}</div>
            <div class="bar">
              <span style="width:${p.scaled}%;background:${Utils.heatColor(p.scaled)}"></span>
            </div>
          </div>
        `).join('')}
      </div>
    </section>
  </div>
`;

this.setStatus(zone, `Composite: ${Math.round(composite)} (${zone.toUpperCase()})`);
this.renderCharts();
```

}

renderCharts() {
const ctx = document.getElementById(‘compositeChart’);
if (!ctx) return;

```
const hist = this.state.compositeHistory;
if (!hist.length) return;

new Chart(ctx, {
  type: 'line',
  data: {
    labels: hist.map(h => h.date),
    datasets: [{
      label: 'Composite Score',
      data: hist.map(h => h.value),
      borderColor: CONFIG.ZONE_COLORS.amber,
      backgroundColor: 'rgba(255,194,71,0.1)',
      borderWidth: 2,
      fill: true,
      tension: 0.25
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: { legend: { display: false } },
    scales: {
      y: { min: 0, max: 100 }
    }
  }
});
```

}

showTab(name) {
document.querySelectorAll(’.tab’).forEach(t => t.classList.remove(‘active’));
document.querySelectorAll(’.tab-content’).forEach(c => c.classList.remove(‘active’));
event.target.classList.add(‘active’);
document.getElementById(‘tab-’ + name).classList.add(‘active’);
}

setStatus(zone, text) {
const color = CONFIG.ZONE_COLORS[zone] || ‘#8fb4ff’;
document.getElementById(‘statusBadge’).innerHTML = ` <div class="status" style="background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08)"> <span class="status-dot" style="background:${color}"></span> <span>${text}</span> </div>`;
}

showError(message) {
document.getElementById(‘mainContent’).innerHTML = ` <div class="error-state"> <h3 style="margin:0 0 8px;color:#ff9da6">⚠️ Unable to Load Data</h3> <p style="margin:0">${message}</p> </div>`;
}
}

// Initialize the app
const app = new App();
document.addEventListener(‘DOMContentLoaded’, () => app.init());
