<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Diagnostics</title>
<style>
body { background:#000; color:#0ff; font-family:monospace; padding:10px; }
pre { white-space:pre-wrap; }
</style>
</head>

<body>
<h2>CrashRadar Diagnostics</h2>
<pre id="log">Starting…</pre>

<script>
function log(msg){ 
  const el=document.getElementById('log'); 
  el.textContent += "\n"+msg; 
}

// global error capture
window.onerror = function(msg,src,line,col,err){
  log("ERROR: "+msg);
  if(err && err.stack) log(err.stack);
};

window.onunhandledrejection = function(e){
  log("UNHANDLED: "+e.reason);
  if(e.reason && e.reason.stack) log(e.reason.stack);
};

// main async runner
(async function run(){
  log("Running diagnostics…");

  // fetch fred_cache
  try {
    const r = await fetch("./data/fred_cache.json?x="+Date.now());
    log("fred_cache status: "+r.status);
    const t = await r.text();
    log("fred_cache length: "+t.length);
  } catch(e){ log("fred_cache ERROR: "+e); }

  // test module imports
  async function test(mod){
    log("Importing "+mod);
    try {
      const m = await import(mod+"?v="+Date.now());
      log("OK exports: "+Object.keys(m).join(", "));
    } catch(e){
      log("FAIL "+mod+" : "+e.message);
      if(e.stack) log(e.stack);
    }
  }

  await test("./js/config.js");
  await test("./js/scoring.js");
  await test("./js/dataService.js");
  await test("./js/uiIndicators.js");
  await test("./js/uiCharts.js");
  await test("./js/uiGauge.js");
  await test("./js/uiAudit.js");
  await test("./js/exports.js");
  await test("./js/app.js");

  log("DONE.");
})();
</script>
</body>
</html>
