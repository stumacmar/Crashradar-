<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Economic Crash Radar Pro</title>
<style>
:root{--bg:#0a0e1a;--panel:#12182b;--muted:#8b96b0;--text:#e8eeff;--accent:#6b9eff;--green:#1ec28b;--amber:#ffc247;--red:#ff6070}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font:15px/1.6 -apple-system,sans-serif;padding:20px}
.wrap{max-width:1400px;margin:0 auto}
h1{font-size:42px;margin-bottom:8px;background:linear-gradient(135deg,var(--text),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.subtitle{color:var(--muted);margin-bottom:24px}
.card{background:var(--panel);border-radius:14px;padding:24px;margin:20px 0;box-shadow:0 4px 24px rgba(0,0,0,.3)}
.gauge-section{display:flex;gap:32px;align-items:center;flex-wrap:wrap}
.gauge{width:200px;height:200px;position:relative;flex-shrink:0}
.gauge-ring{position:absolute;inset:0;border-radius:50%;background:conic-gradient(var(--green) 0 108deg,var(--amber) 108deg 216deg,var(--red) 216deg 360deg)}
.gauge-ring::after{content:"";position:absolute;inset:20px;border-radius:50%;background:var(--panel)}
.gauge-needle{position:absolute;inset:0;transition:transform .6s}
.gauge-needle::before{content:"";position:absolute;top:50%;left:50%;width:4px;height:45%;background:var(--accent);transform:translateX(-50%) translateY(-100%) rotate(var(--angle,0deg));transform-origin:bottom;border-radius:4px}
.gauge-score{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:48px;font-weight:800}
.gauge-info{flex:1;min-width:300px}
.gauge-info h2{font-size:28px;margin-bottom:8px}
.info-box{background:rgba(107,158,255,.08);border-left:3px solid var(--accent);padding:12px;border-radius:8px;margin:12px 0;font-size:13px;line-height:1.6}
.regime-box{background:rgba(255,255,255,.04);padding:16px;border-radius:10px;margin:16px 0}
.regime-header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
.regime-dot{width:12px;height:12px;border-radius:50%}
.regime-title{font-size:18px;font-weight:700}
.regime-desc{font-size:13px;color:var(--muted);margin-bottom:12px}
.regime-actions{display:grid;gap:8px;margin-top:12px}
.regime-action{background:rgba(255,255,255,.03);padding:10px;border-radius:8px;font-size:12px}
.action-title{font-weight:600;margin-bottom:2px}
.risk-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin:16px 0}
.risk-card{background:rgba(255,255,255,.03);padding:18px;border-radius:12px}
.risk-title{font-size:12px;text-transform:uppercase;color:var(--muted);margin-bottom:8px}
.risk-value{font-size:32px;font-weight:800;color:var(--accent);margin-bottom:8px}
.risk-desc{font-size:12px;color:var(--muted);line-height:1.5;margin-bottom:8px}
.risk-detail{font-size:11px;padding-top:8px;border-top:1px solid rgba(255,255,255,.06)}
.pills{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
.pill{background:rgba(255,255,255,.03);border-left:4px solid;padding:16px;border-radius:10px;transition:transform .2s}
.pill:hover{transform:translateY(-2px)}
.pill.rag-green{border-left-color:var(--green)}
.pill.rag-amber{border-left-color:var(--amber)}
.pill.rag-red{border-left-color:var(--red)}
.pill-header{display:flex;justify-content:space-between;margin-bottom:8px}
.pill-title{font-weight:600;font-size:14px}
.pill-status{font-size:10px;padding:4px 8px;border-radius:6px;text-transform:uppercase;font-weight:600}
.status-green{background:rgba(30,194,139,.15);color:var(--green)}
.status-amber{background:rgba(255,194,71,.15);color:var(--amber)}
.status-red{background:rgba(255,96,112,.15);color:var(--red)}
.pill-value{font-size:22px;font-weight:700;margin:6px 0}
.pill-desc{font-size:11px;color:var(--muted);line-height:1.4;margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,.06)}
.pill-action{font-size:11px;font-weight:600;margin-top:6px;padding:6px;background:rgba(255,255,255,.02);border-radius:6px}
.tabs{display:flex;gap:8px;border-bottom:2px solid rgba(255,255,255,.06);margin:20px 0}
.tab{background:transparent;border:none;color:var(--muted);padding:12px 20px;cursor:pointer;font-size:14px;font-weight:600;position:relative}
.tab:hover{color:var(--text)}
.tab.active{color:var(--accent)}
.tab.active::after{content:"";position:absolute;bottom:-2px;left:0;right:0;height:2px;background:var(--accent)}
.tab-content{display:none}
.tab-content.active{display:block}
.heatmap{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.heat-cell{background:rgba(255,255,255,.03);padding:16px;border-radius:10px;border-left:4px solid}
.heat-cell.rag-green{border-left-color:var(--green)}
.heat-cell.rag-amber{border-left-color:var(--amber)}
.heat-cell.rag-red{border-left-color:var(--red)}
.heat-label{font-size:13px;font-weight:600;margin-bottom:6px}
.heat-value{font-size:26px;font-weight:700;margin:6px 0}
.heat-status{font-size:11px;color:var(--muted)}
.loading{text-align:center;padding:40px;color:var(--muted)}
.error{background:rgba(255,96,112,.1);border:1px solid rgba(255,96,112,.3);padding:20px;border-radius:14px;margin:20px 0;color:#ff9da6}
.chart-container{height:320px;margin:16px 0}
@media(max-width:768px){.gauge-section{justify-content:center}.pills{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>⚡ Economic Crash Radar Pro</h1>
<div class="subtitle">Real-time market stress monitoring with forward-looking risk assessment</div>
<div id="status"></div>
</header>
<main id="app"><div class="loading">Loading economic data...</div></main>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
'use strict';
const C={P:'data/fred_cache.json',I:{T10Y3M:{l:'Yield Curve',f:v=>v?.toFixed(2)+'%',w:.18,c:'daily',d:'10Y-3M Treasury spread',i:'Inverted curves precede recessions 6-18 months',t:{g:[.5,99],a:[-.5,.5],r:[-99,-.5]},act:{g:'Normal - continue allocation',a:'Flattening - monitor closely',r:'INVERTED - Reduce equity exposure'}},CREDIT:{l:'Credit Spread',f:v=>v?.toFixed(2)+'%',w:.14,c:'daily',d:'High-yield spread over Treasuries',i:'Widening = rising default risk. >7% = distress',t:{g:[-99,4.5],a:[4.5,7],r:[7,99]},act:{g:'Healthy credit markets',a:'Rising risk premium',r:'CRUNCH - Exit high-yield'}},UN_SLOPE6:{l:'Unemployment Trend',f:v=>(v>=0?'+':'')+v?.toFixed(2)+'%',w:.12,c:'monthly',d:'6-month unemployment change',i:'Sahm Rule: >0.5% rise signals recession',t:{g:[-99,.15],a:[.15,.35],r:[.35,99]},act:{g:'Stable labor market',a:'Softening employment',r:'RECESSION LIKELY'}},DD_12M:{l:'Market Drawdown',f:v=>((v??0)*100).toFixed(1)+'%',w:.2,c:'daily',d:'S&P 500 from peak',i:'-10%=correction, -20%=bear',t:{g:[-5,0],a:[-15,-5],r:[-99,-15]},act:{g:'Near highs',a:'Correction territory',r:'BEAR MARKET'}},NFCI:{l:'Financial Conditions',f:v=>v?.toFixed(2),w:.12,c:'weekly',d:'Chicago Fed NFCI',i:'>0=tight. Sharp rises precede downturns',t:{g:[-99,-.2],a:[-.2,.3],r:[.3,99]},act:{g:'Easy conditions',a:'Tightening',r:'STRESS rising'}},VIX_PROXY:{l:'Volatility',f:v=>v?.toFixed(1),w:.1,c:'daily',d:'VIX fear gauge',i:'<15=calm, 20-30=elevated, >30=panic',t:{g:[-99,20],a:[20,30],r:[30,99]},act:{g:'Low volatility',a:'Rising fear',r:'MARKET PANIC'}},RETAIL_MOMENTUM:{l:'Retail Sales',f:v=>((v??0)*100).toFixed(2)+'%',w:.08,c:'monthly',d:'Consumer spending (70% GDP)',i:'Negative for 2+ months = recession risk',t:{g:[.01,99],a:[-.01,.01],r:[-99,-.01]},act:{g:'Strong spending',a:'Stalling',r:'RETRENCHMENT'}},SENTIMENT:{l:'Consumer Confidence',f:v=>v?.toFixed(1),w:.06,c:'monthly',d:'U. Michigan sentiment',i:'<80=pessimistic. Sharp drops precede recessions',t:{g:[90,999],a:[70,90],r:[-99,70]},act:{g:'Optimistic',a:'Cautious',r:'FEARFUL consumers'}}}};
const U={p:v=>{if(v==null||v==='.'||v==='NaN'||v==='')return null;const n=+v;return isFinite(n)?n:null},m:(v,g,b)=>{if(v==null)return 50;const d=b-g;return Math.max(0,Math.min(100,((v-g)/d)*100))},z:s=>s<=30?'green':(s<=60?'amber':'red'),rag:(v,t)=>{if(!t||v==null)return'amber';if(v>=t.r[0]&&v<=t.r[1])return'red';if(v>=t.a[0]&&v<=t.a[1])return'amber';return'green'}};
const S={T10Y3M:v=>U.m(v,1,-2),CREDIT:v=>U.m(v,3,8),UN_SLOPE6:v=>U.m(v,.05,.5),DD_12M:v=>U.m(v,0,-.2),NFCI:v=>U.m(v,-.8,.4),VIX_PROXY:v=>U.m(v,12,35),RETAIL_MOMENTUM:v=>U.m(v,.03,-.02),SENTIMENT:v=>U.m(v,110,70)};
class D{static async load(){const r=await fetch(`${C.P}?t=${Date.now()}`,{cache:'no-store'});if(!r.ok)throw new Error(`HTTP ${r.status}`);return this.norm(await r.json())}static norm(raw){const o={};if(!raw)return o;if(typeof raw==='object'&&Object.keys(raw).some(k=>raw[k]&&Array.isArray(raw[k].observations)))return raw;if(Array.isArray(raw?.series)){for(const s of raw.series){const id=s.id||s.series_id||s.name;if(id)o[id]={observations:s.observations||s.data||[],fetchedAt:s.fetchedAt}}return o}if(raw.series&&typeof raw.series==='object'){for(const[id,s]of Object.entries(raw.series)){o[id]={observations:s?.observations||s?.data||[],fetchedAt:s.fetchedAt}}return o}return o}static lat(s){const obs=s?.observations||[];if(!obs.length)return null;const o=obs[obs.length-1];return{value:U.p(o.value),date:o.date}}static age(s){const l=this.lat(s);if(!l)return 999;return Math.round((Date.now()-new Date(l.date+'T00:00:00Z'))/86400000)}}
class Der{static un6(U){const obs=U?.observations||[];if(!obs.length)return null;const m={};for(const o of obs){const v=U.p(o.value);if(v!==null)m[o.date.slice(0,7)]=v}const mons=Object.keys(m).sort();if(mons.length<7)return null;const out=[];for(let i=6;i<mons.length;i++){const cur=mons[i],prv=mons[i-6];const d=m[cur]-m[prv];const[y,mm]=cur.split('-').map(Number);out.push({date:new Date(Date.UTC(y,mm,0)).toISOString().slice(0,10),value:String(d)})}return{observations:out,fetchedAt:U.fetchedAt}}static dd12(SP){const obs=SP?.observations||[];if(!obs.length)return null;const dates=obs.map(o=>o.date);const vals=obs.map(o=>U.p(o.value));const pk=[];for(let i=0;i<vals.length;i++){let p=-Infinity;for(let j=Math.max(0,i-252);j<=i;j++){if(vals[j]!==null)p=Math.max(p,vals[j])}pk.push(p)}return{observations:dates.map((d,i)=>({date:d,value:vals[i]!==null&&pk[i]!==-Infinity?String(vals[i]/pk[i]-1):'.'})),fetchedAt:SP.fetchedAt}}static ret(R){const o=R?.observations||[];if(o.length<2)return null;const last=U.p(o[o.length-1].value);let prv=null;for(let i=o.length-2;i>=0;i--){const v=U.p(o[i].value);if(v!==null){prv=v;break}}if(prv===null||prv===0||last===null)return null;return{observations:[{date:o[o.length-1].date,value:String(last/prv-1)}],fetchedAt:R.fetchedAt}}}
class P{static map(c){const o={};for(const k of Object.keys(C.I)){if(c[k])o[k]=c[k]}if(!o.CREDIT&&c.BAMLH0A0HYM2)o.CREDIT=c.BAMLH0A0HYM2;if(!o.VIX_PROXY&&c.VIXCLS)o.VIX_PROXY=c.VIXCLS;if(!o.SENTIMENT&&c.UMCSENT)o.SENTIMENT=c.UMCSENT;if(!o.UN_SLOPE6&&c.UNRATE)o.UN_SLOPE6=Der.un6(c.UNRATE)||{observations:[],fetchedAt:c.UNRATE.fetchedAt};if(!o.DD_12M&&c.SP500)o.DD_12M=Der.dd12(c.SP500)||{observations:[],fetchedAt:c.SP500.fetchedAt};if(!o.RETAIL_MOMENTUM&&c.RSAFS)o.RETAIL_MOMENTUM=Der.ret(c.RSAFS)||{observations:[],fetchedAt:c.RSAFS.fetchedAt};return o}static comp(dm){let n=0,d=0;const pts=[];for(const[k,cfg]of Object.entries(C.I)){const s=dm[k];if(!s?.observations?.length)continue;const l=D.lat(s);if(!l||l.value===null)continue;const age=D.age(s);const sc=S[k](l.value);const w=cfg.w*(age<=30?1:.8);if(isFinite(sc)&&isFinite(w)){n+=sc*w;d+=w}const rag=U.rag(l.value,cfg.t);pts.push({k,l:cfg.l,v:l.value,d:cfg.f(l.value),sc,rag,age,desc:cfg.d,int:cfg.i,act:cfg.act})}return{pts,comp:d>0?n/d:50}}static risk(c,h){const base=x=>1/(1+Math.exp(-(x-50)/10));const p1=Math.round(base(c)*.7*100);const p3=Math.round(base(c)*.95*100);const p6=Math.round(base(c)*1.2*100);return{p1:Math.max(5,Math.min(95,p1)),p3:Math.max(5,Math.min(95,p3)),p6:Math.max(5,Math.min(95,p6))}}}
class App{constructor(){this.app=document.getElementById('app')}async init(){try{const c=await D.load();const dm=P.map(c);const{pts,comp}=P.comp(dm);const z=U.z(comp);const{p1,p3,p6}=P.risk(comp,[]);const conf=Math.round((pts.filter(p=>p.age<=30).length/pts.length)*100);const red=pts.filter(p=>p.rag==='red');const zc={'green':'#1ec28b','amber':'#ffc247','red':'#ff6070'}[z];const zn={'green':'Normal','amber':'Stressed','red':'Crisis'}[z];const zd={'green':'Economic fundamentals stable. Normal volatility expected. Continue regular investment approach.','amber':'Elevated stress across indicators. Increased volatility probability. Monitor closely, consider reducing risk.','red':'Critical stress levels. Multiple recession signals triggered. High downturn probability. Defensive positioning recommended.'}[z];this.app.innerHTML=`<div class="card"><div class="gauge-section"><div class="gauge"><div class="gauge-ring"></div><div class="gauge-needle" style="--angle:${(comp/100)*360}deg"></div><div class="gauge-score">${Math.round(comp)}</div></div><div class="gauge-info"><h2>Market Stress: ${Math.round(comp)}/100</h2><div style="color:var(--muted);margin-bottom:12px">Composite of ${pts.length} indicators</div><div class="info-box"><strong>Data Confidence: ${conf}%</strong><br>${conf>=80?'High - all current':conf>=60?'Moderate - some stale data':'Low - significant staleness'}</div><div class="regime-box"><div class="regime-header"><div class="regime-dot" style="background:${zc}"></div><div class="regime-title">${zn} Regime</div></div><div class="regime-desc">${zd}</div>${red.length>0?`<div class="regime-actions">${red.map(p=>`<div class="regime-action"><div class="action-title">⚠️ ${p.l}</div>${p.act[p.rag]}</div>`).join('')}</div>`:''}</div></div></div></div><div class="card"><h3 style="margin:0 0 16px">Forward Risk Horizon</h3><div class="risk-grid"><div class="risk-card"><div class="risk-title">1-Month Risk</div><div class="risk-value">${p1}%</div><div class="risk-desc">Probability of >10% drawdown in 30 days based on current stress and momentum.</div><div class="risk-detail"><strong>Means:</strong> ${p1<20?'Low near-term risk':p1<40?'Elevated volatility expected':'High crash probability'}</div></div><div class="risk-card"><div class="risk-title">3-Month Risk</div><div class="risk-value">${p3}%</div><div class="risk-desc">Probability of >15% correction in next quarter incorporating medium-term trends.</div><div class="risk-detail"><strong>Means:</strong> ${p3<25?'Markets should stay stable':p3<50?'Correction possible':'High correction risk'}</div></div><div class="risk-card"><div class="risk-title">6-Month Risk</div><div class="risk-value">${p6}%</div><div class="risk-desc">Probability of bear market (>20%) or recession based on historical patterns.</div><div class="risk-detail"><strong>Means:</strong> ${p6<30?'Low recession risk':p6<60?'Elevated recession risk':'Recession likely'}</div></div></div></div><div class="tabs"><button class="tab active" onclick="app.show('ind')">Indicators</button><button class="tab" onclick="app.show('heat')">Heat Map</button></div><div id="tab-ind" class="tab-content active"><div class="card"><h3 style="margin:0 0 16px">Individual Indicators</h3><div class="pills">${pts.map(p=>`<div class="pill rag-${p.rag}"><div class="pill-header"><div class="pill-title">${p.l}</div><div class="pill-status status-${p.rag}">${p.rag.toUpperCase()}</div></div><div class="pill-value">${p.d}</div><div class="pill-desc"><strong>${p.desc}</strong><br>${p.int}</div><div class="pill-action" style="color:var(--${p.rag})">${p.act[p.rag]}</div>${p.age>30?`<div style="font-size:10px;color:var(--amber);margin-top:6px">⚠️ Data ${p.age} days old</div>`:''}</div>`).join('')}</div></div></div><div id="tab-heat" class="tab-content"><div class="card"><h3 style="margin:0 0 16px">Heat Map</h3><div class="heatmap">${pts.map(p=>`<div class="heat-cell rag-${p.rag}"><div class="heat-label">${p.l}</div><div class="heat-value">${p.d}</div><div class="heat-status">${p.rag.toUpperCase()} - ${p.act[p.rag]}</div></div>`).join('')}</div></div></div>`;document.getElementById('status').innerHTML=`<div style="color:${zc};margin:8px 0">● Composite: ${Math.round(comp)} (${zn})</div>`}catch(e){console.error(e);this.app.innerHTML=`<div class="error"><h3>⚠️ Error</h3><p>${e.message}</p></div>`}}show(t){document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));event.target.classList.add('active');document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));document.getElementById('tab-'+t).classList.add('active')}}
const app=new App();
document.addEventListener('DOMContentLoaded',()=>app.init());
</script>
</body>
</html>
