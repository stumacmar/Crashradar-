<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CrashRadar Deep Diagnostic</title>

  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: monospace;
      white-space: pre-wrap;
      padding: 20px;
      font-size: 14px;
    }
    .error { color: #f33; }
    .ok { color: #0f0; }
    .warn { color: #ff0; }
  </style>
</head>

<body>
<h2>CrashRadar Deep Diagnostic</h2>
<div id="out">Starting…</div>

<script type="module">
const out = document.getElementById("out");
function log(msg, cls="ok") {
  const span = document.createElement("div");
  span.className = cls;
  span.textContent = msg;
  out.appendChild(span);
}

async function loadModule(path) {
  try {
    const m = await import(path);
    log(`✓ Loaded: ${path}`);
    return m;
  } catch (e) {
    log(`✗ FAILED to load ${path}`, "error");
    log(String(e), "error");
    return null;
  }
}

/* REQUIRED EXPORTS PER FILE */
const EXPORTS = {
  "./js/config.js": [
    "INDICATOR_CONFIG",
    "VALUATION_CONFIG",
    "MACRO_BLOCK_WEIGHT",
    "VALUATION_BLOCK_WEIGHT"
  ],
  "./js/scoring.js": [
    "computeComposite",
    "scaleIndicator",
    "stressVerdictLabel",
    "valuationStress",
    "derivedRecessionRisk",
    "derivedValuationRisk",
    "derivedLaborStress",
    "computeContributions"
  ],
  "./js/dataService.js": [
    "getSeries",
    "computeCurrentForIndicator",
    "loadFredCache",
    "loadCurrentIndicatorValues"
  ],
  "./js/uiIndicators.js": [
    "renderMacroIndicators",
    "renderValuationIndicators"
  ],
  "./js/uiCharts.js": [
    "updateCompositeHistoryChart",
    "updateRiskRadarChart",
    "toggleIndicatorExpansion",
    "handleHistoryPeriodClick"
  ],
  "./js/uiGauge.js": [
    "updateGaugeAndStatus",
    "syncValuationSummary",
    "updateInsightText",
    "updateContributions"
  ],
  "./js/uiAudit.js": [
    "updateDataAudit"
  ],
  "./js/exports.js": [
    "exportToCSV",
    "exportToPDF",
    "saveSnapshot",
    "shareLink"
  ],
  "./js/app.js": []  // We will test AFTER all modules load
};

async function run() {
  log("Loading modules…\n");

  const loaded = {};
  for (const path of Object.keys(EXPORTS)) {
    const mod = await loadModule(path);
    loaded[path] = mod;

    if (!mod) continue;

    // Verify exports
    for (const ex of EXPORTS[path]) {
      if (mod[ex] === undefined) {
        log(`  ✗ missing export: ${ex}`, "error");
      } else {
        log(`  ✓ export found: ${ex}`);
      }
    }

    log("");
  }

  log("\nTesting app.js separately…\n");

  try {
    await import("./js/app.js");
    log("✓ app.js loaded OK");
  } catch (e) {
    log("✗ app.js FAILED to load", "error");
    log(String(e), "error");
  }

  log("\nDiagnostics complete.\n");
}

run();
</script>

</body>
</html>
