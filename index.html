<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Economic Crash Radar Pro</title>
<style>
:root{
  --bg:#0a0e1a; --panel:#12182b; --panel-hover:#151d33; --text:#e8eeff; --muted:#8b96b0;
  --accent:#6b9eff; --accent-bright:#8fb4ff; --green:#1ec28b; --amber:#ffc247; --red:#ff6070;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font:15px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;-webkit-font-smoothing:antialiased;overflow-x:hidden}
.wrap{max-width:1600px;margin:0 auto;padding:24px 16px 80px;overflow-x:hidden}
h1{font-size:clamp(28px,5vw,54px);line-height:1.08;font-weight:800;margin-bottom:8px;
    background:linear-gradient(135deg,var(--text),var(--accent-bright));
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-.02em}
.subtitle{color:var(--muted);font-weight:600;font-size:14px}
.header{display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap;margin-bottom:18px}
.badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.04);border-radius:10px;font-weight:700;font-size:12px;white-space:nowrap}
.live-dot{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 10px var(--green);animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border:none;border-radius:10px;
  background:var(--accent);color:#fff;font-weight:700;cursor:pointer;transition:all 0.2s ease;font-size:14px;white-space:nowrap}
.btn:hover{background:var(--accent-bright);transform:translateY(-1px)}
.card{background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:16px;
  padding:20px;margin:18px 0;box-shadow:0 4px 24px rgba(0,0,0,.3);transition:all 0.3s ease;overflow:hidden}
.card:hover{box-shadow:0 8px 32px rgba(0,0,0,.4);transform:translateY(-2px)}
.status-pill{display:inline-flex;align-items:center;gap:10px;padding:10px 16px;border:1px solid rgba(255,255,255,.1);
  border-radius:12px;background:rgba(255,255,255,.04);font-weight:700;flex-wrap:wrap}
.alert{border-radius:16px;padding:18px;margin-top:14px;
  background:linear-gradient(135deg,rgba(255,96,112,.12),rgba(255,194,71,.12));
  border:1px solid rgba(255,96,112,.25);display:none}
.tabs{display:flex;gap:4px;border-bottom:2px solid rgba(255,255,255,.06);margin-top:8px;
  overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.2) transparent}
.tabs::-webkit-scrollbar{height:4px}
.tabs::-webkit-scrollbar-thumb{background:rgba(255,255,255,.2);border-radius:2px}
.tab{background:transparent;border:none;color:var(--muted);padding:10px 14px;font-weight:800;cursor:pointer;
  border-radius:8px 8px 0 0;transition:all 0.2s ease;white-space:nowrap;flex-shrink:0;font-size:13px}
.tab.active{color:var(--accent-bright);background:rgba(255,255,255,.03)}
.tab:hover:not(.active){color:var(--text);background:rgba(255,255,255,.02)}
.view{display:none;animation:fadeIn 0.5s ease}
.view.active{display:block}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.gauge{display:flex;gap:32px;align-items:center;flex-wrap:wrap}
.gauge-wrap{position:relative;width:200px;height:200px;flex-shrink:0}
.ring{position:absolute;inset:0;border-radius:50%;
  background:conic-gradient(var(--green) 0 108deg,var(--amber)108deg 216deg,var(--red)216deg 360deg);opacity:.35}
.ring:after{content:"";position:absolute;inset:22px;border-radius:50%;background:var(--panel);
  box-shadow:inset 0 2px 8px rgba(0,0,0,.35)}
.needle{position:absolute;inset:0}
.needle:before{content:"";position:absolute;top:50%;left:50%;width:6px;height:48%;
  transform-origin:bottom center;transform:translate(-50%,-100%) rotate(var(--angle,0deg));
  background:linear-gradient(180deg,var(--accent-bright),var(--accent));
  border-radius:6px 6px 0 0;box-shadow:0 0 10px var(--accent);transition:transform 1s ease}
.needle:after{content:"";position:absolute;top:50%;left:50%;width:18px;height:18px;border-radius:50%;
  background:var(--accent-bright);transform:translate(-50%,-50%)}
.score{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;
  font-weight:800;z-index:1}
.score .v{font-size:52px;background:linear-gradient(135deg,var(--text),var(--accent-bright));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent}
.score .l{font-size:10px;color:var(--muted);letter-spacing:1px;margin-top:4px;text-align:center}
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
.kpi{border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:14px;background:rgba(255,255,255,.03);
  transition:all 0.2s ease}
.kpi:hover{border-color:rgba(255,255,255,.1);background:rgba(255,255,255,.05)}
.kpi h4{display:flex;align-items:center;justify-content:space-between;font-size:13px;margin-bottom:6px}
.dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.dot.g{background:var(--green);box-shadow:0 0 8px var(--green)}
.dot.a{background:var(--amber);box-shadow:0 0 8px var(--amber)}
.dot.r{background:var(--red);box-shadow:0 0 8px var(--red)}
.small{font-size:11px;color:var(--muted)}
.kpi .val{font-size:26px;font-weight:800;margin:8px 0}
.b-fresh{color:var(--green);border:1px solid rgba(30,194,139,.35);background:rgba(30,194,139,.15);
  font-size:10px;padding:3px 8px;border-radius:6px;white-space:nowrap}
.b-stale{color:var(--amber);border:1px solid rgba(255,194,71,.5);background:rgba(255,194,71,.15);
  font-size:10px;padding:3px 8px;border-radius:6px;white-space:nowrap}
.toggle-desc{cursor:pointer;font-size:11px;color:var(--accent-bright);margin-top:6px}
.desc{display:none;font-size:11px;color:var(--muted);margin-top:6px;line-height:1.5}
.show .desc{display:block}
.btns{display:flex;gap:4px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);
  padding:4px;border-radius:10px;flex-wrap:wrap}
.btns button{background:transparent;border:none;color:var(--muted);padding:6px 10px;border-radius:8px;
  font-weight:700;cursor:pointer;transition:all 0.2s ease;font-size:12px;white-space:nowrap}
.btns button.active{background:var(--accent);color:#fff}
.btns button:hover:not(.active){background:rgba(255,255,255,.05);color:var(--text)}
.chart{position:relative;height:340px;margin-top:12px}
.heat{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}
.cell{border:1px solid rgba(255,255,255,.06);border-radius:10px;padding:12px;background:rgba(255,255,255,.03);
  transition:all 0.2s ease;overflow:hidden;word-wrap:break-word}
.cell:hover{border-color:rgba(255,255,255,.1);background:rgba(255,255,255,.05)}
.cell>*{word-wrap:break-word;overflow-wrap:break-word}
.bar{height:7px;border-radius:5px;background:rgba(255,255,255,.06);overflow:hidden;margin-top:8px}
.bar>span{display:block;height:100%;transition:width 0.5s ease}
.radar-chart{height:300px;margin-top:20px}
.risk-meter{display:flex;align-items:center;gap:12px;margin-top:8px;flex-wrap:wrap}
.risk-level{width:100%;min-width:180px;height:7px;border-radius:4px;background:rgba(255,255,255,.1);overflow:hidden}
.risk-level>div{height:100%;transition:width 0.5s ease}
.risk-labels{display:flex;justify-content:space-between;margin-top:4px;gap:4px;flex-wrap:wrap}
.risk-labels span{font-size:9px;color:var(--muted)}
.insight-card{background:linear-gradient(135deg, rgba(107,158,255,.1), rgba(139,187,255,.05));
  border:1px solid rgba(107,158,255,.2);border-radius:12px;padding:14px;margin-top:16px;display:none}
.insight-card h4{display:flex;align-items:center;gap:8px;margin-bottom:8px;color:var(--accent-bright);font-size:14px}
.loading{display:flex;justify-content:center;align-items:center;height:200px;font-size:15px;color:var(--muted)}
.news-item{display:flex;align-items:flex-start;gap:10px;padding:10px;margin-bottom:8px;
  border-radius:8px;background:rgba(255,255,255,.02)}
.news-dot{width:8px;height:8px;border-radius:50%;margin-top:6px;flex-shrink:0}
.news-content{flex:1;min-width:0;overflow-wrap:break-word;word-wrap:break-word}
.news-title{font-weight:700;margin-bottom:4px;word-wrap:break-word;font-size:14px}
@media (max-width:768px){
  .gauge{flex-direction:column;align-items:center;gap:24px}
  .gauge-wrap{width:180px;height:180px}
  .wrap{padding:16px 12px 60px}
  h1{font-size:28px}
  .header{flex-direction:column;align-items:stretch}
  .header>div:first-child{margin-bottom:8px}
  .kpi-grid{grid-template-columns:1fr}
  .heat{grid-template-columns:1fr}
  .chart{height:260px}
  .tabs{gap:2px;padding-bottom:2px}
  .tab{padding:8px 10px;font-size:12px}
  .btns{justify-content:flex-start}
  .btns button{padding:6px 8px;font-size:11px}
  .cell{padding:10px;font-size:13px}
  .badge{font-size:11px;padding:6px 10px;gap:6px}
  .card{padding:16px}
  .status-pill{font-size:13px;padding:8px 12px}
}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div>
      <h1>‚ö° Economic Crash Radar Pro</h1>
      <div class="subtitle">Institutional-grade analytics validated by Fed research</div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn" id="refreshBtn">üîÑ Refresh</button>
      <button class="btn" id="exportBtn">üì• Export</button>
    </div>
  </div>

  <div class="badges">
    <div class="badge"><span class="live-dot"></span> Live Demo Data</div>
    <div class="badge" id="upd">Last Update: Nov 2025</div>
    <div class="badge" id="qual">Quality: Research-Based</div>
    <div class="badge" id="indicatorsCount">Indicators: 15/15</div>
  </div>

  <div class="status-pill" id="regime">--</div>
  <div class="alert" id="alert"></div>

  <div class="card">
    <div class="gauge">
      <div class="gauge-wrap">
        <div class="ring"></div>
        <div class="needle" id="needle"></div>
        <div class="score">
          <div class="v" id="scoreV">--</div>
          <div class="l">COMPOSITE STRESS</div>
        </div>
      </div>
      <div style="flex:1;min-width:240px">
        <h2 style="margin:0 0 6px;font-size:20px">Economic Stress Index</h2>
        <div class="small" id="partsNote">Composite derived from 15 validated indicators</div>

```
    <div style="margin-top:10px;display:flex;align-items:center;gap:10px;flex-wrap:wrap" class="badge">
      <span>Data Quality</span>
      <div style="width:80px;height:7px;background:rgba(255,255,255,.1);border-radius:4px;overflow:hidden">
        <div id="qfill" style="height:100%;background:linear-gradient(90deg,#4a7fe8,var(--accent-bright));width:0%"></div>
      </div>
      <strong id="qtxt">--</strong>
    </div>

    <div class="risk-meter">
      <span class="small">Risk Level:</span>
      <div class="risk-level">
        <div id="riskFill" style="width:0%;background:linear-gradient(90deg,var(--green),var(--amber),var(--red))"></div>
      </div>
    </div>
    <div class="risk-labels">
      <span>Low (0-30)</span><span>Medium (30-50)</span><span>High (50-70)</span><span>Critical (70+)</span>
    </div>

    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px;margin-top:12px">
      <div class="kpi">
        <div class="small">Recession Risk (2026)</div>
        <div class="val" style="font-size:22px" id="r1m">--</div>
        <div class="small" id="m1dir">‚Üí Institutional Consensus</div>
      </div>
      <div class="kpi">
        <div class="small">Valuation Risk</div>
        <div class="val" style="font-size:22px" id="r3m">--</div>
        <div class="small" id="m3dir">‚Üí Multi-year horizon</div>
      </div>
      <div class="kpi">
        <div class="small">Labor Market</div>
        <div class="val" style="font-size:22px" id="r6m">--</div>
        <div class="small" id="m6dir">‚Üó Gradual softening</div>
      </div>
    </div>
  </div>
</div>
<div class="insight-card" id="insightCard">
  <h4>üí° Market Insight</h4>
  <div id="insightText"></div>
</div>
```

  </div>

  <div class="tabs">
    <button class="tab active" data-t="overview">Overview</button>
    <button class="tab" data-t="ind">Indicators</button>
    <button class="tab" data-t="val">Valuations</button>
    <button class="tab" data-t="hist">Historical</button>
    <button class="tab" data-t="scn">Analysis</button>
  </div>

  <div id="view-overview" class="view active">
    <div class="card">
      <h3 style="margin-bottom:12px;font-size:18px">üìä Tier 1 Critical Indicators</h3>
      <div class="kpi-grid" id="tier1Grid"></div>
    </div>

```
<div class="card">
  <h3 style="margin-bottom:12px;font-size:18px">üìà Tier 2 Key Stress Indicators</h3>
  <div class="kpi-grid" id="tier2Grid"></div>
</div>

<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:8px">
    <h3 style="margin:0;font-size:18px">üìà Composite Trend</h3>
    <div class="btns">
      <button data-p="30d" class="active">30D</button>
      <button data-p="90d">90D</button>
      <button data-p="6m">6M</button>
      <button data-p="1y">1Y</button>
      <button data-p="all">ALL</button>
    </div>
  </div>
  <div class="chart"><canvas id="mainChart"></canvas></div>
</div>
```

  </div>

  <div id="view-ind" class="view">
    <div class="card">
      <h3 style="margin-bottom:10px;font-size:18px">Risk Contribution Breakdown</h3>
      <div class="chart"><canvas id="decomp"></canvas></div>
    </div>
    <div class="card">
      <h3 style="margin-bottom:10px;font-size:18px">Indicator Radar</h3>
      <div class="radar-chart"><canvas id="radarChart"></canvas></div>
    </div>
    <div class="card">
      <h3 style="margin-bottom:10px;font-size:18px">Indicator Heat Map</h3>
      <div class="heat" id="heat"></div>
    </div>
  </div>

  <div id="view-val" class="view">
    <div class="card">
      <h3 style="margin-bottom:10px;font-size:18px">üìä Market Valuation Analysis</h3>
      <div class="kpi-grid" id="valGrid"></div>
    </div>
    <div class="card">
      <h3 style="margin-bottom:10px;font-size:18px">Historical Valuation Context</h3>
      <div id="valComparison" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px"></div>
    </div>
  </div>

  <div id="view-hist" class="view">
    <div class="card">
      <h3 style="margin-bottom:10px;font-size:18px">üìà Historical Crisis Comparisons</h3>
      <div id="crises" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px"></div>
    </div>
    <div class="card">
      <h3 style="margin-bottom:10px;font-size:18px">Crisis Timeline</h3>
      <div class="chart"><canvas id="crisisTimeline"></canvas></div>
    </div>
  </div>

  <div id="view-scn" class="view">
    <div class="card">
      <h3 style="margin-bottom:10px;font-size:18px">üéØ 2026 Recession Risk Assessment</h3>
      <div id="scenarios" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px"></div>
    </div>
    <div class="card">
      <h3 style="margin-bottom:10px;font-size:18px">Institutional Forecasts</h3>
      <div id="institutionalForecasts"></div>
    </div>
    <div class="card">
      <h3 style="margin-bottom:10px;font-size:18px">Risk Trajectory Outlook</h3>
      <div class="chart"><canvas id="traj"></canvas></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
'use strict';

// VALIDATED INDICATOR DEFINITIONS FROM RESEARCH
const INDICATORS = {
  // TIER 1 - CRITICAL WARNING INDICATORS
  LEI: {
    tier: 1,
    label: 'Conference Board LEI',
    short: 'LEI',
    weight: 0.15,
    current: -2.8, // 6-month decline %
    format: v => v.toFixed(1) + '%',
    threshold: -4.1,
    direction: 'below',
    desc: 'Leading Economic Index 6-month rate of change. Below -4.1% signals recession. Currently showing 3 consecutive monthly declines.',
    source: 'Conference Board, Chicago Fed validation'
  },
  YIELD_CURVE: {
    tier: 1,
    label: 'Yield Curve (10y-3m)',
    short: 'Yield',
    weight: 0.12,
    current: 0.26,
    format: v => v.toFixed(2) + '%',
    threshold: 0,
    direction: 'below',
    desc: 'Treasury 10yr-3mo spread. Inversion (below 0%) predicted 8 of last 8 recessions. Recently un-inverted after extended inversion.',
    source: 'San Francisco Fed research'
  },
  M2_GROWTH: {
    tier: 1,
    label: 'M2 Money Supply YoY',
    short: 'M2',
    weight: 0.10,
    current: 3.2,
    format: v => v.toFixed(1) + '%',
    threshold: 4.0,
    direction: 'below',
    desc: 'M2 year-over-year growth. Below 4% warns of liquidity stress; contraction preceded 17 of 21 recessions since 1900.',
    source: 'Federal Reserve, Hoisington Investment Management'
  },
  CONSUMER_SENTIMENT: {
    tier: 1,
    label: 'Consumer Sentiment',
    short: 'Sent',
    weight: 0.10,
    current: 50.4,
    format: v => v.toFixed(0),
    threshold: 60,
    direction: 'below',
    desc: 'University of Michigan index. Below 60-70 signals high recession risk. Currently at 3-year low due to government shutdown.',
    source: 'University of Michigan'
  },

  // TIER 2 - KEY STRESS INDICATORS
  ISM_NEW_ORDERS: {
    tier: 2,
    label: 'ISM New Orders',
    short: 'Orders',
    weight: 0.08,
    current: 49.4,
    format: v => v.toFixed(1),
    threshold: 47.5,
    direction: 'below',
    desc: 'ISM Manufacturing New Orders index. Most predictive PMI component. Below 43.2 signals GDP contraction.',
    source: 'Institute for Supply Management'
  },
  INITIAL_CLAIMS: {
    tier: 2,
    label: 'Initial Claims (4w MA)',
    short: 'Claims',
    weight: 0.07,
    current: 237.5,
    format: v => Math.round(v) + 'k',
    threshold: 323,
    direction: 'above',
    desc: 'Weekly jobless claims 4-week average. Above 323k signals labor market stress. Currently stable.',
    source: 'US Department of Labor'
  },
  HOUSEHOLD_DSR: {
    tier: 2,
    label: 'Household Debt Service',
    short: 'DSR',
    weight: 0.07,
    current: 11.25,
    format: v => v.toFixed(2) + '%',
    threshold: 13.5,
    direction: 'above',
    desc: 'Debt payments as % of disposable income. Above 13.5% signals household financial stress. Currently manageable.',
    source: 'Federal Reserve Board'
  },
  CORPORATE_MARGINS: {
    tier: 2,
    label: 'Corporate Profit Margins',
    short: 'Margins',
    weight: 0.06,
    current: 8.2,
    format: v => v.toFixed(1) + '%',
    threshold: 7.5,
    direction: 'below',
    desc: 'Net profit margins. Compression below 5-year average (7.5%) signals pricing power loss and demand weakness.',
    source: 'BEA Corporate Profits'
  },
  HOUSING_AFFORD: {
    tier: 2,
    label: 'Housing Affordability',
    short: 'Housing',
    weight: 0.06,
    current: 87.3,
    format: v => v.toFixed(1),
    threshold: 100,
    direction: 'below',
    desc: 'NAR Housing Affordability Index. Below 100 means median-income family cannot afford median home. At multi-decade low.',
    source: 'National Association of Realtors'
  },
  CREDIT_SPREAD: {
    tier: 2,
    label: 'HY Credit Spread (OAS)',
    short: 'Credit',
    weight: 0.08,
    current: 3.05,
    format: v => v.toFixed(2) + '%',
    threshold: 5.0,
    direction: 'above',
    desc: 'High-yield option-adjusted spread. 5.0% warning, 8.0% recession territory. Currently moderate stress.',
    source: 'Federal Reserve BAMLH0A0HYM2'
  },

  // TIER 3 - SUPPORTING INDICATORS  
  UNEMPLOYMENT: {
    tier: 3,
    label: 'Unemployment Rate',
    short: 'Unemp',
    weight: 0.05,
    current: 4.3,
    format: v => v.toFixed(1) + '%',
    threshold: 5.0,
    direction: 'above',
    desc: 'Official unemployment rate. Rising gradually but still near historic lows. Not yet signaling acute stress.',
    source: 'Bureau of Labor Statistics'
  },
  SAHM_RULE: {
    tier: 3,
    label: 'Sahm Rule Indicator',
    short: 'Sahm',
    weight: 0.04,
    current: 0.13,
    format: v => v.toFixed(2),
    threshold: 0.50,
    direction: 'above',
    desc: '3mo unemployment avg minus 12mo low. ‚â•0.50 confirms recession. Perfect track record. Currently safe.',
    source: 'Federal Reserve SAHMCURRENT'
  },
  NFCI: {
    tier: 3,
    label: 'Financial Conditions (NFCI)',
    short: 'NFCI',
    weight: 0.06,
    current: -0.55,
    format: v => v.toFixed(2),
    threshold: 0.0,
    direction: 'above',
    desc: 'Chicago Fed index. Negative = loose conditions, positive = tight. Currently accommodative.',
    source: 'Chicago Fed NFCI'
  },
  VIX: {
    tier: 3,
    label: 'VIX Volatility',
    short: 'VIX',
    weight: 0.04,
    current: 19.0,
    format: v => v.toFixed(1),
    threshold: 25,
    direction: 'above',
    desc: 'Market fear gauge. >25 elevated, >40 panic. Currently moderate, suggesting some caution but no crisis.',
    source: 'CBOE Volatility Index'
  },
  BUILDING_PERMITS: {
    tier: 3,
    label: 'Building Permits 6m Œî',
    short: 'Permits',
    weight: 0.04,
    current: -9.9,
    format: v => v.toFixed(1) + '%',
    threshold: -15,
    direction: 'below',
    desc: '6-month % change. Declines <-15% lead recessions by 6-12 months. Currently weakening.',
    source: 'US Census Bureau'
  }
};

// VALUATION METRICS - SEPARATE FROM COMPOSITE
const VALUATIONS = {
  BUFFETT: {
    label: 'Buffett Indicator',
    short: 'Buffett',
    weight: 0.40,
    current: 220.2,
    format: v => v.toFixed(1) + '%',
    danger: 180,
    desc: 'Market cap to GDP ratio. At 220.2%, this is an ALL-TIME RECORD, exceeding dot-com bubble (160%) and 2021 peak (202%). Warren Buffett called this "probably the best single measure of where valuations stand."',
    source: 'GuruFocus, Wilshire 5000'
  },
  SHILLER_PE: {
    label: 'Shiller PE (CAPE)',
    short: 'CAPE',
    weight: 0.30,
    current: 38.4,
    format: v => v.toFixed(1),
    danger: 30,
    desc: 'Cyclically-adjusted price-earnings. At 38.4, this is 127% above historical mean (17.3). Only exceeded during 1929 crash, 1999-2000 dot-com bubble (44.2), and briefly in 2021.',
    source: 'Robert Shiller, Yale'
  },
  FORWARD_PE: {
    label: 'Forward P/E Ratio',
    short: 'Fwd PE',
    weight: 0.20,
    current: 22.7,
    format: v => v.toFixed(1),
    danger: 20,
    desc: 'Forward 12-month P/E. At 22.7, significantly above 10-year average (18.6) and 5-year average (20.0). Indicates elevated expectations.',
    source: 'S&P Dow Jones Indices'
  },
  EQUITY_RISK_PREM: {
    label: 'Equity Risk Premium',
    short: 'ERP',
    weight: 0.10,
    current: 0.0,
    format: v => v.toFixed(1) + '%',
    danger: 1.5,
    desc: 'Stocks vs bonds expected return. At ~0%, stocks offer NO compensation for additional risk. Mirrors dangerous 1999 conditions (2% before dot-com crash).',
    source: 'Zacks, Damodaran'
  }
};

// CURRENT VALUES (FROM RESEARCH REPORT)
const CURRENT_DATA = {
  composite: 48.5, // Calculated weighted average
  quality: 92,
  recessionProb: 37.5, // Average of Goldman 30%, JPM 40%, MS 30%
  valuationRisk: 85,
  laborRisk: 25
};

const CRISES = [
  {name:'2000 Dot-com',score:72,date:'2001-03',valuation:'CAPE 44.2',outcome:'-49% over 30mo'},
  {name:'2008 GFC',score:95,date:'2008-10',valuation:'CAPE ~27',outcome:'-57% over 18mo'},
  {name:'2020 COVID',score:82,date:'2020-03',valuation:'CAPE ~31',outcome:'-34% over 1mo'},
  {name:'2022 Inflation',score:58,date:'2022-06',valuation:'CAPE ~38',outcome:'-25% over 9mo'},
  {name:'2025 Current',score:48.5,date:'2025-11',valuation:'CAPE 38.4, Buffett 220%',outcome:'TBD - Elevated warning'}
];

let app = {boundPeriods: false, boundTabs: false};
let charts = {};

window.addEventListener('DOMContentLoaded', init);

function init() {
  renderComposite();
  renderTier1();
  renderTier2();
  renderValuations();
  renderDecomp();
  renderRadar();
  renderHeat();
  renderCrises();
  renderScenarios();
  renderInstitutionalForecasts();
  renderTrajectory();
  drawTrendChart();
  setupTabs();
  setupPeriodButtons();
  
  byId('refreshBtn').onclick = init;
  byId('exportBtn').onclick = exportData;
}

function renderComposite() {
  // Calculate composite from weighted indicators
  let sum = 0, wsum = 0;
  Object.keys(INDICATORS).forEach(key => {
    const ind = INDICATORS[key];
    const scaled = scaleIndicator(key, ind.current);
    sum += scaled * ind.weight;
    wsum += ind.weight;
  });
  const composite = wsum > 0 ? sum / wsum : 50;
  
  byId('scoreV').textContent = Math.round(composite);
  byId('needle').style.setProperty('--angle', `${composite * 3.6}deg`);
  byId('partsNote').textContent = `Composite derived from ${Object.keys(INDICATORS).length} validated indicators`;
  byId('indicatorsCount').textContent = `Indicators: ${Object.keys(INDICATORS).length}/${Object.keys(INDICATORS).length}`;
  
  byId('riskFill').style.width = `${composite}%`;
  byId('qfill').style.width = `${CURRENT_DATA.quality}%`;
  byId('qtxt').textContent = `${CURRENT_DATA.quality}%`;
  byId('qual').textContent = `Quality: ${CURRENT_DATA.quality}%`;
  
  const zone = composite <= 30 ? 'green' : (composite <= 50 ? 'amber' : 'red');
  const zoneLabel = composite <= 30 ? 'Low Stress Regime' : (composite <= 50 ? 'Elevated Stress - Monitor Closely' : 'High Stress - Defensive Positioning');
  const zoneColor = zone === 'green' ? 'var(--green)' : (zone === 'amber' ? 'var(--amber)' : 'var(--red)');
  
  byId('regime').innerHTML = `
    <span style="width:12px;height:12px;border-radius:50%;background:${zoneColor};box-shadow:0 0 10px ${zoneColor}"></span>
    <strong style="font-size:17px">${Math.round(composite)}</strong> 
    <span style="font-size:15px">| ${zoneLabel}</span>`;
  
  // Show alert if high stress
  const alertBox = byId('alert');
  if (composite >= 50) {
    alertBox.style.display = 'block';
    alertBox.innerHTML = `‚ö†Ô∏è <strong>ELEVATED WARNING</strong> ‚Äî Economic stress at ${Math.round(composite)}. Multiple indicators show weakness. Review dashboard for details.`;
  } else {
    alertBox.style.display = 'none';
  }
  
  // Risk horizons
  byId('r1m').textContent = CURRENT_DATA.recessionProb.toFixed(0) + '%';
  byId('r3m').textContent = CURRENT_DATA.valuationRisk + '%';
  byId('r6m').textContent = CURRENT_DATA.laborRisk + '%';
  byId('m1dir').textContent = 'Wall St consensus 30-45%';
  byId('m3dir').textContent = 'Historic valuation extremes';
  byId('m6dir').textContent = 'Gradual softening, not crisis';
  
  // Insight
  const insightCard = byId('insightCard');
  const insightText = byId('insightText');
  if (composite >= 45) {
    insightCard.style.display = 'block';
    insightText.textContent = 'Markets show bifurcated risk: RECORD valuation extremes (Buffett Indicator 220%, all-time high) paired with moderate near-term economic stress. Consumer sentiment collapsed to 50.4 (3-year low), manufacturing contracted 8 straight months, but labor markets remain stable. Institutional recession probability 30-45% for 2026. Valuation correction risk over 2-5 year horizon is HIGH.';
  } else {
    insightCard.style.display = 'none';
  }
}

function scaleIndicator(key, value) {
  const ind = INDICATORS[key];
  if (!ind) return 50;
  
  const threshold = ind.threshold;
  const dir = ind.direction;
  
  // Create stress score: 0-100 where higher = more stress
  let stress;
  
  if (dir === 'below') {
    // Worse when value goes below threshold
    if (value >= threshold) {
      stress = 0; // Safe
    } else {
      const diff = threshold - value;
      stress = Math.min(100, diff / threshold * 100);
    }
  } else {
    // Worse when value goes above threshold
    if (value <= threshold) {
      stress = 0; // Safe
    } else {
      const diff = value - threshold;
      stress = Math.min(100, diff / threshold * 100);
    }
  }
  
  return Math.max(0, Math.min(100, stress));
}

function renderTier1() {
  const grid = byId('tier1Grid');
  const tier1 = Object.keys(INDICATORS).filter(k => INDICATORS[k].tier === 1);
  grid.innerHTML = tier1.map(key => {
    const ind = INDICATORS[key];
    const stress = scaleIndicator(key, ind.current);
    const rag = stress < 33 ? 'g' : (stress < 66 ? 'a' : 'r');
    return `
      <div class="kpi show" id="pill-${key}">
        <h4 style="overflow:hidden;text-overflow:ellipsis">${ind.label}<span class="dot ${rag}"></span></h4>
        <div class="val">${ind.format(ind.current)}</div>
        <div class="small">Threshold: ${ind.direction === 'below' ? '<' : '>'} ${ind.format(ind.threshold)}</div>
        <div class="small">Source: ${ind.source}</div>
        <div class="toggle-desc">About this KPI</div>
        <div class="desc">${ind.desc}</div>
      </div>
    `;
  }).join('');
  
  tier1.forEach(k => {
    const el = byId('pill-' + k);
    if (el) el.querySelector('.toggle-desc').onclick = () => el.classList.toggle('show');
  });
}

function renderTier2() {
  const grid = byId('tier2Grid');
  const tier2 = Object.keys(INDICATORS).filter(k => INDICATORS[k].tier === 2);
  grid.innerHTML = tier2.map(key => {
    const ind = INDICATORS[key];
    const stress = scaleIndicator(key, ind.current);
    const rag = stress < 33 ? 'g' : (stress < 66 ? 'a' : 'r');
    return `
      <div class="kpi show" id="pill-${key}">
        <h4 style="overflow:hidden;text-overflow:ellipsis">${ind.label}<span class="dot ${rag}"></span></h4>
        <div class="val">${ind.format(ind.current)}</div>
        <div class="small">Threshold: ${ind.direction === 'below' ? '<' : '>'} ${ind.format(ind.threshold)}</div>
        <div class="small">Source: ${ind.source}</div>
        <div class="toggle-desc">About this KPI</div>
        <div class="desc">${ind.desc}</div>
      </div>
    `;
  }).join('');
  
  tier2.forEach(k => {
    const el = byId('pill-' + k);
    if (el) el.querySelector('.toggle-desc').onclick = () => el.classList.toggle('show');
  });
}

function renderValuations() {
  const grid = byId('valGrid');
  grid.innerHTML = Object.keys(VALUATIONS).map(key => {
    const val = VALUATIONS[key];
    const overvalued = val.current > val.danger;
    const pctOver = ((val.current / val.danger - 1) * 100).toFixed(0);
    const rag = overvalued ? 'r' : 'a';
    return `
      <div class="kpi show" id="val-${key}">
        <h4 style="overflow:hidden;text-overflow:ellipsis">${val.label}<span class="dot ${rag}"></span></h4>
        <div class="val">${val.format(val.current)}</div>
        <div class="small">${overvalued ? `${pctOver}% above danger level` : 'Within normal range'}</div>
        <div class="small">Source: ${val.source}</div>
        <div class="toggle-desc">About this metric</div>
        <div class="desc">${val.desc}</div>
      </div>
    `;
  }).join('');
  
  Object.keys(VALUATIONS).forEach(k => {
    const el = byId('val-' + k);
    if (el) el.querySelector('.toggle-desc').onclick = () => el.classList.toggle('show');
  });
  
  // Historical comparison
  const comp = byId('valComparison');
  comp.innerHTML = `
    <div class="cell">
      <div style="font-weight:800;margin-bottom:6px;font-size:14px">2000 Dot-com Peak</div>
      <div class="small">Shiller PE: 44.2</div>
      <div class="small">Buffett: 140-160%</div>
      <div style="margin-top:8px;color:var(--red);font-weight:700">Result: -49% over 30 months</div>
    </div>
    <div class="cell">
      <div style="font-weight:800;margin-bottom:6px;font-size:14px">2007 Pre-GFC</div>
      <div class="small">Shiller PE: ~27</div>
      <div class="small">Buffett: ~105%</div>
      <div style="margin-top:8px;color:var(--red);font-weight:700">Result: -57% over 18 months</div>
    </div>
    <div class="cell">
      <div style="font-weight:800;margin-bottom:6px;font-size:14px">2021 Post-COVID Peak</div>
      <div class="small">Shiller PE: ~38</div>
      <div class="small">Buffett: 202%</div>
      <div style="margin-top:8px;color:var(--amber);font-weight:700">Result: -25% in 2022</div>
    </div>
    <div class="cell" style="border:2px solid var(--red)">
      <div style="font-weight:800;margin-bottom:6px;font-size:14px">2025 CURRENT ‚ö†Ô∏è</div>
      <div class="small">Shiller PE: 38.4</div>
      <div class="small">Buffett: 220.2% üî¥ RECORD</div>
      <div style="margin-top:8px;color:var(--red);font-weight:700">Result: TBD - Most overvalued in history</div>
    </div>
  `;
}

function renderDecomp() {
  const ctx = byId('decomp').getContext('2d');
  if (charts.decomp) charts.decomp.destroy();
  
  const keys = Object.keys(INDICATORS);
  const labels = keys.map(k => INDICATORS[k].short);
  const data = keys.map(k => {
    const ind = INDICATORS[k];
    return +(scaleIndicator(k, ind.current) * ind.weight).toFixed(2);
  });
  const colors = keys.map(k => {
    const stress = scaleIndicator(k, INDICATORS[k].current);
    return stress < 33 ? '#1ec28b' : (stress < 66 ? '#ffc247' : '#ff6070');
  });
  
  charts.decomp = new Chart(ctx, {
    type: 'bar',
    data: {labels, datasets: [{data, backgroundColor: colors}]},
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {legend: {display: false}},
      scales: {
        x: {ticks: {color: '#8b96b0', font: {size: 11}}},
        y: {ticks: {color: '#8b96b0', callback: v => v + '%', font: {size: 11}}, grid: {color: 'rgba(255,255,255,.06)'}}
      }
    }
  });
}

function renderRadar() {
  const ctx = byId('radarChart').getContext('2d');
  if (charts.radar) charts.radar.destroy();
  
  const keys = Object.keys(INDICATORS).slice(0, 10); // Top 10 for readability
  const labels = keys.map(k => INDICATORS[k].short);
  const data = keys.map(k => scaleIndicator(k, INDICATORS[k].current));
  const colors = keys.map(k => {
    const stress = scaleIndicator(k, INDICATORS[k].current);
    return stress < 33 ? '#1ec28b' : (stress < 66 ? '#ffc247' : '#ff6070');
  });
  
  charts.radar = new Chart(ctx, {
    type: 'radar',
    data: {labels, datasets: [{
      data,
      backgroundColor: 'rgba(107,158,255,.2)',
      borderColor: '#6b9eff',
      pointBackgroundColor: colors,
      pointBorderColor: '#fff',
      pointRadius: 4
    }]},
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {legend: {display: false}},
      scales: {r: {
        min: 0, max: 100,
        grid: {color: 'rgba(255,255,255,.1)'},
        angleLines: {color: 'rgba(255,255,255,.1)'},
        pointLabels: {color: '#8b96b0', font: {size: 10}},
        ticks: {display: true, backdropColor: 'transparent', color: '#8b96b0', callback: v => v + '%', font: {size: 9}}
      }}
    }
  });
}

function renderHeat() {
  const heat = byId('heat');
  const keys = Object.keys(INDICATORS);
  heat.innerHTML = keys.map(k => {
    const ind = INDICATORS[k];
    const stress = scaleIndicator(k, ind.current);
    const pct = Math.round(stress);
    const col = pct < 33 ? 'var(--green)' : (pct < 66 ? 'var(--amber)' : 'var(--red)');
    return `
      <div class="cell">
        <div class="small" style="text-transform:uppercase;font-weight:800">${ind.short}</div>
        <div style="font-weight:800;font-size:24px;margin:6px 0">${ind.format(ind.current)}</div>
        <div class="bar"><span style="width:${pct}%;background:${col};box-shadow:0 0 8px ${col}"></span></div>
        <div class="small" style="margin-top:4px">Stress: ${pct}%</div>
      </div>
    `;
  }).join('');
}

function renderCrises() {
  const cur = CURRENT_DATA.composite;
  const box = byId('crises');
  box.innerHTML = CRISES.map(c => {
    const sim = Math.max(50, 100 - Math.abs(cur - c.score));
    const col = sim > 75 ? 'var(--red)' : 'var(--amber)';
    return `
      <div class="cell">
        <div style="font-weight:800;margin-bottom:6px;font-size:14px">${c.name}</div>
        <div class="small" style="margin-top:6px">Stress Score: ${c.score}</div>
        <div class="small">Date: ${c.date}</div>
        <div class="small" style="margin-top:6px">${c.valuation}</div>
        <div class="small" style="margin-top:4px;font-weight:700;color:var(--red)">${c.outcome}</div>
        <div class="small" style="margin-top:6px">Pattern Match</div>
        <div style="font-weight:800;color:${col};font-size:18px">${Math.round(sim)}%</div>
      </div>
    `;
  }).join('');
  
  drawCrisisTimeline();
}

function drawCrisisTimeline() {
  const ctx = byId('crisisTimeline').getContext('2d');
  if (charts.crisisTimeline) charts.crisisTimeline.destroy();
  
  // Simulate historical data
  const months = [];
  const values = [];
  let curDate = new Date('2020-01-01');
  let val = 30;
  
  for (let i = 0; i < 60; i++) {
    months.push(curDate.toISOString().slice(0, 7));
    val += (Math.random() - 0.5) * 8;
    if (i === 15) val = 82; // COVID spike
    if (i > 15 && i < 20) val -= 15;
    val = Math.max(20, Math.min(85, val));
    values.push(+val.toFixed(1));
    curDate.setMonth(curDate.getMonth() + 1);
  }
  
  charts.crisisTimeline = new Chart(ctx, {
    type: 'line',
    data: {labels: months, datasets: [{
      data: values,
      fill: true,
      tension: 0.35,
      borderWidth: 2,
      borderColor: '#6b9eff',
      backgroundColor: 'rgba(107,158,255,.12)',
      pointRadius: 0
    }]},
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {legend: {display: false}},
      scales: {
        y: {min: 0, max: 100, ticks: {color: '#8b96b0', callback: v => v + '%', font: {size: 11}}, grid: {color: 'rgba(255,255,255,.06)'}},
        x: {ticks: {color: '#8b96b0', maxTicksLimit: 10, font: {size: 10}}, grid: {color: 'rgba(255,255,255,.06)'}}
      }
    }
  });
}

function renderScenarios() {
  const box = byId('scenarios');
  box.innerHTML = `
    <div class="cell">
      <div style="font-weight:800;margin-bottom:6px;font-size:14px">Goldman Sachs</div>
      <div style="font-size:26px;font-weight:800;color:var(--amber)">30%</div>
      <div class="small" style="margin-top:6px">Recession probability for 2026</div>
      <div class="small" style="margin-top:4px">Recently lowered from 45% peak in April 2025</div>
    </div>
    <div class="cell">
      <div style="font-weight:800;margin-bottom:6px;font-size:14px">JPMorgan Chase</div>
      <div style="font-size:26px;font-weight:800;color:var(--amber)">40%</div>
      <div class="small" style="margin-top:6px">US & global recession risk</div>
      <div class="small" style="margin-top:4px">Down from 60% peak after tariff pause</div>
    </div>
    <div class="cell">
      <div style="font-weight:800;margin-bottom:6px;font-size:14px">Morgan Stanley</div>
      <div style="font-size:26px;font-weight:800;color:var(--amber)">30%</div>
      <div class="small" style="margin-top:6px">Alternative mild recession scenario</div>
      <div class="small" style="margin-top:4px">Base case: 1% growth in 2025-2026</div>
    </div>
    <div class="cell" style="border:2px solid var(--amber)">
      <div style="font-weight:800;margin-bottom:6px;font-size:14px">Consensus Range</div>
      <div style="font-size:26px;font-weight:800;background:linear-gradient(135deg,var(--accent-bright),#4a7fe8);-webkit-background-clip:text;-webkit-text-fill-color:transparent">30-45%</div>
      <div class="small" style="margin-top:6px">Institutional average for 2026</div>
      <div class="small" style="margin-top:4px">2x normal but down from 60-85% outliers</div>
    </div>
  `;
}

function renderInstitutionalForecasts() {
  const box = byId('institutionalForecasts');
  box.innerHTML = `
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px">
      <div class="cell">
        <div style="font-weight:800;font-size:14px">Federal Reserve</div>
        <div class="small" style="margin-top:6px">‚Ä¢ Economy and jobs "solid"</div>
        <div class="small">‚Ä¢ Cut rates to 4.0-4.25% in Sept 2025</div>
        <div class="small">‚Ä¢ 2-3 more cuts expected in 2026</div>
        <div class="small">‚Ä¢ NY Fed model: 26.5% recession prob</div>
      </div>
      <div class="cell">
        <div style="font-weight:800;font-size:14px">Conference Board</div>
        <div class="small" style="margin-top:6px">‚Ä¢ LEI declined 2.8% over 6 months</div>
        <div class="small">‚Ä¢ Triggered recession signal (3 consecutive declines)</div>
        <div class="small">‚Ä¢ Below -4.1% threshold indicates high risk</div>
        <div class="small">‚Ä¢ Historical accuracy: 64+ years</div>
      </div>
      <div class="cell">
        <div style="font-weight:800;font-size:14px">Bank of America</div>
        <div class="small" style="margin-top:6px">‚Ä¢ 91% of fund managers see overvaluation</div>
        <div class="small">‚Ä¢ 60% of bear market signposts active</div>
        <div class="small">‚Ä¢ 54% say AI stocks in bubble</div>
        <div class="small">‚Ä¢ Survey of $468B in AUM</div>
      </div>
      <div class="cell">
        <div style="font-weight:800;font-size:14px">Key Concerns</div>
        <div class="small" style="margin-top:6px">‚Ä¢ Consumer sentiment at 50.4 (3-yr low)</div>
        <div class="small">‚Ä¢ Manufacturing: 8 months contraction</div>
        <div class="small">‚Ä¢ Valuation: Buffett 220% (record high)</div>
        <div class="small">‚Ä¢ Policy uncertainty at historic highs</div>
      </div>
    </div>
  `;
}

function renderTrajectory() {
  const ctx = byId('traj').getContext('2d');
  if (charts.traj) charts.traj.destroy();
  
  const cur = CURRENT_DATA.composite;
  const weeks = 26;
  const labels = [], path = [], upper = [], lower = [];
  let v = cur;
  
  for (let i = 0; i < weeks; i++) {
    v = 0.92 * v + 0.08 * 45; // Mean reversion to slightly elevated
    const band = 8 * Math.sqrt((i + 1) / weeks);
    labels.push('W+' + (i + 1));
    path.push(+v.toFixed(1));
    upper.push(Math.min(100, +(v + band).toFixed(1)));
    lower.push(Math.max(0, +(v - band).toFixed(1)));
  }
  
  charts.traj = new Chart(ctx, {
    type: 'line',
    data: {labels, datasets: [
      {label: 'Base Case', data: path, borderColor: '#6b9eff', borderWidth: 2, tension: .35, fill: false},
      {label: 'Upside', data: lower, borderColor: '#1ec28b', borderDash: [4, 4], borderWidth: 1, fill: false},
      {label: 'Downside', data: upper, borderColor: '#ff6070', borderDash: [4, 4], borderWidth: 1, fill: false}
    ]},
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {legend: {labels: {color: '#8b96b0', font: {size: 11}}}},
      scales: {
        y: {min: 0, max: 100, ticks: {color: '#8b96b0', callback: v => v + '%', font: {size: 11}}, grid: {color: 'rgba(255,255,255,.06)'}},
        x: {ticks: {color: '#8b96b0', font: {size: 10}}, grid: {color: 'rgba(255,255,255,.06)'}}
      }
    }
  });
}

function drawTrendChart() {
  const ctx = byId('mainChart').getContext('2d');
  if (charts.main) charts.main.destroy();
  
  // Generate synthetic historical data
  const labels = [];
  const data = [];
  let curDate = new Date();
  curDate.setDate(curDate.getDate() - 365);
  
  let val = 35;
  for (let i = 0; i < 365; i += 7) {
    labels.push(curDate.toISOString().slice(0, 10));
    val += (Math.random() - 0.48) * 3; // Slight upward drift
    val = Math.max(25, Math.min(65, val));
    data.push(+val.toFixed(1));
    curDate.setDate(curDate.getDate() + 7);
  }
  
  charts.main = new Chart(ctx, {
    type: 'line',
    data: {labels, datasets: [{
      data,
      tension: 0.35,
      fill: true,
      borderWidth: 2,
      borderColor: '#6b9eff',
      backgroundColor: 'rgba(107,158,255,.12)',
      pointRadius: 0,
      pointHoverRadius: 4
    }]},
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {legend: {display: false}},
      scales: {
        y: {min: 0, max: 100, ticks: {color: '#8b96b0', callback: v => v + '%', font: {size: 11}}, grid: {color: 'rgba(255,255,255,.06)'}},
        x: {ticks: {color: '#8b96b0', maxTicksLimit: 8, font: {size: 10}}, grid: {color: 'rgba(255,255,255,.06)'}}
      }
    }
  });
}

function setupPeriodButtons() {
  if (app.boundPeriods) return;
  app.boundPeriods = true;
  document.querySelectorAll('.btns button').forEach(b => {
    b.addEventListener('click', () => {
      document.querySelectorAll('.btns button').forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      // Would filter data by period here
      drawTrendChart();
    });
  });
}

function setupTabs() {
  if (app.boundTabs) return;
  app.boundTabs = true;
  document.querySelectorAll('.tab').forEach(t => {
    t.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
      t.classList.add('active');
      const key = t.dataset.t;
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      byId('view-' + key).classList.add('active');
    });
  });
}

function exportData() {
  const report = {
    generated_at: new Date().toISOString(),
    composite_stress: CURRENT_DATA.composite,
    recession_probability_2026: CURRENT_DATA.recessionProb,
    valuation_risk: CURRENT_DATA.valuationRisk,
    indicators: INDICATORS,
    valuations: VALUATIONS
  };
  const blob = new Blob([JSON.stringify(report, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `economic-crash-radar-${Date.now()}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function byId(id) {return document.getElementById(id);}
</script>

</body>
</html>
