<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CrashRadar Diagnostics</title>

  <style>
    body {
      background: #0b0f16;
      color: #d0d8f0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 20px;
    }
    #log {
      white-space: pre-wrap;
      background: #121826;
      padding: 16px;
      border-radius: 12px;
      border: 1px solid #334;
      font-size: 14px;
      height: 80vh;
      overflow-y: scroll;
    }
  </style>

  <script>
    window.__APP_BASE = "";
    const log = (msg) => {
      const el = document.getElementById("log");
      el.textContent += msg + "\n";
      console.log(msg);
    };
  </script>
</head>

<body>

<h1>CrashRadar Diagnostics</h1>
<p>This page loads each module individually and logs success/failure.</p>

<div id="log">Starting diagnostics…\n</div>

<script type="module">
  const log = (msg) => {
    const el = document.getElementById("log");
    el.textContent += msg + "\n";
    console.log(msg);
  };

  log("STEP 1 — Checking fetch for data/fred_cache.json…");

  try {
    const res = await fetch("./data/fred_cache.json?ts=" + Date.now());
    log("Fetch status: " + res.status);

    if (!res.ok) {
      log("❌ fred_cache.json NOT FOUND or NOT ACCESSIBLE");
    } else {
      const j = await res.json();
      log("✔ fred_cache.json loaded. Keys: " + Object.keys(j.series).length);
    }
  } catch (e) {
    log("❌ Exception fetching fred_cache.json: " + e.message);
  }

  log("\nSTEP 2 — Testing module import paths…");

  async function testModule(path) {
    try {
      log("⏳ Loading " + path);
      await import(path);
      log("✔ Loaded " + path);
    } catch (e) {
      log("❌ FAILED to load " + path + "\n" + e.message + "\n");
    }
  }

  await testModule("./js/config.js");
  await testModule("./js/scoring.js");
  await testModule("./js/dataService.js");
  await testModule("./js/uiIndicators.js");
  await testModule("./js/uiCharts.js");
  await testModule("./js/uiGauge.js");
  await testModule("./js/uiAudit.js");
  await testModule("./js/exports.js");
  await testModule("./js/app.js");

  log("\nDiagnostics complete.\nScroll up to see any failures.");
</script>

</body>
</html>
